# üî• –î–µ–Ω—å 16. –ü–µ—Ä–≤—ã–π RAG-–∑–∞–ø—Ä–æ—Å

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ RAG (Retrieval-Augmented Generation) –∫ LLM —á–µ—Ä–µ–∑ OpenRouter –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å RAG –∏ –±–µ–∑ RAG.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —É—Ä–æ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ RAG –∫ LLM –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —á–∞–Ω–∫–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ OpenRouter** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç LLM
- **RAG-–∑–∞–ø—Ä–æ—Å—ã** ‚Äî –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Ö –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤** —Å RAG (—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º) –∏ –±–µ–∑ RAG (–æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º)
- **UI –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

[–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∂–Ω–æ –∑–¥–µ—Å—å](https://disk.yandex.ru/i/gopw2mP-d_HXPA)

## üéØ –ü–∞–π–ø–ª–∞–π–Ω RAG-–∑–∞–ø—Ä–æ—Å–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å
   ‚Üì
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ (—á–µ—Ä–µ–∑ Ollama)
   ‚Üì
3. –ü–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —á–∞–Ω–∫–æ–≤ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π (–∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ)
   ‚Üì
4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–∞–Ω–∫–æ–≤ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (–ø–æ–ª–µ content)
   ‚Üì
5. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ —á–∞–Ω–∫–æ–≤
   ‚Üì
6. –ó–∞–ø—Ä–æ—Å –∫ LLM —á–µ—Ä–µ–∑ OpenRouter —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (RAG-—Ä–µ–∂–∏–º)
   ‚Üì
7. –ó–∞–ø—Ä–æ—Å –∫ LLM —á–µ—Ä–µ–∑ OpenRouter –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º)
   ‚Üì
8. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –∏ –≤—ã–≤–æ–¥—ã
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–í–æ–ø—Ä–æ—Å ‚Üí KnowledgeBaseSearchService ‚Üí –ü–æ–∏—Å–∫ —á–∞–Ω–∫–æ–≤ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
                                    ‚Üì
                    –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –ë–î (–ø–æ–ª–µ content)
                                    ‚Üì
                    PromptBuilder ‚Üí –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
                                    ‚Üì
                    RAGService ‚Üí –ó–∞–ø—Ä–æ—Å –∫ OpenRouter (RAG)
                                    ‚Üì
                    ComparisonService ‚Üí –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ–±—ã—á–Ω—ã–º —Ä–µ–∂–∏–º–æ–º
                                    ‚Üì
                    –ê–Ω–∞–ª–∏–∑ –∏ –≤—ã–≤–æ–¥—ã
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lesson-16-rag-query/
‚îú‚îÄ‚îÄ README.md              # –û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞
‚îú‚îÄ‚îÄ PROMPT.md              # –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ THEORY.md              # –¢–µ–æ—Ä–∏—è –ø–æ RAG
‚îú‚îÄ‚îÄ CHAT_PROMPT.txt        # –ö—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI –∞–≥–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ server.yaml        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Ollama, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, RAG)
‚îú‚îÄ‚îÄ server/                # –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (Kotlin + Ktor)
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/
‚îÇ       ‚îú‚îÄ‚îÄ data/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ repository/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ KnowledgeBaseRepository.kt
‚îÇ       ‚îú‚îÄ‚îÄ domain/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ agent/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BaseAgent.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SimpleLLMAgent.kt
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ indexing/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CosineSimilarityCalculator.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TextChunker.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TokenCounter.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ VectorNormalizer.kt
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentIndexer.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentLoader.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmbeddingService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KnowledgeBaseSearchService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LLMService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromptBuilder.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RAGService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ComparisonService.kt
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ model/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ RAGRequest.kt
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ RAGResponse.kt
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ ComparisonResult.kt
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ RetrievedChunk.kt
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ TextChunk.kt
‚îÇ       ‚îî‚îÄ‚îÄ presentation/
‚îÇ           ‚îú‚îÄ‚îÄ controller/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ ClientController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ IndexingController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ SearchController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ LLMController.kt
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ RAGController.kt
‚îÇ           ‚îî‚îÄ‚îÄ dto/
‚îÇ               ‚îú‚îÄ‚îÄ DocumentDtos.kt
‚îÇ               ‚îú‚îÄ‚îÄ ErrorResponse.kt
‚îÇ               ‚îî‚îÄ‚îÄ RAGDtos.kt
‚îî‚îÄ‚îÄ client/                # –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (Vanilla JS)
    ‚îú‚îÄ‚îÄ index.html         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    ‚îú‚îÄ‚îÄ indexing.html      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ‚îú‚îÄ‚îÄ indexing.js
    ‚îú‚îÄ‚îÄ search.html        # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    ‚îú‚îÄ‚îÄ search.js
    ‚îú‚îÄ‚îÄ rag-compare.html   # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è RAG –∏ –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
    ‚îú‚îÄ‚îÄ rag-compare.js
    ‚îú‚îÄ‚îÄ style.css
    ‚îî‚îÄ‚îÄ app.js
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:**
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
   - SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ `documents` –∏ `document_chunks`
   - –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ `documents/`

2. **Ollama:**
   - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ –∑–∞–ø—É—â–µ–Ω–∞: https://ollama.ai/
   - –ó–∞–≥—Ä—É–∂–µ–Ω–∞ –º–æ–¥–µ–ª—å –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤: `ollama pull nomic-embed-text`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `curl http://localhost:11434/api/tags`

3. **OpenRouter:**
   - API –∫–ª—é—á –æ—Ç OpenRouter: https://openrouter.ai/
   - –î–æ–±–∞–≤–∏—Ç—å –≤ `.env` (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞): `OPENAI_API_KEY=your_key`
   - –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `config/server.yaml` (–ø–∞—Ä–∞–º–µ—Ç—Ä `ai.model`)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–æ):
```bash
git clone <repository-url>
cd ai_challenge_november/lesson-16-rag-query
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config/server.yaml:
# - ollama.baseUrl
# - ollama.model (–¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤)
# - knowledgeBase.databasePath
# - ai.provider (openrouter)
# - ai.model (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤)

# –°–æ–∑–¥–∞–π—Ç–µ .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
# OPENAI_API_KEY=your_openrouter_api_key
```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
cd server
./gradlew run
```

4. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–ª–∏–µ–Ω—Ç:**
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:8080
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- **–ì–ª–∞–≤–Ω–∞—è:** http://localhost:8080/
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:** http://localhost:8080/indexing.html
- **–ü–æ–∏—Å–∫:** http://localhost:8080/search.html
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ RAG:** http://localhost:8080/rag-compare.html

## üì° API Endpoints

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

- `POST /api/indexing/index` ‚Äî –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç/—Ñ–∞–π–ª
- `GET /api/indexing/documents` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /api/search/query` ‚Äî –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

### RAG-–∑–∞–ø—Ä–æ—Å—ã

### 1. RAG-–∑–∞–ø—Ä–æ—Å (—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º)

**POST** `/api/rag/query`

**Request:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "topK": 3,
  "minSimilarity": 0.5
}
```

**Response:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "answer": "–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ...",
  "contextChunks": [
    {
      "chunkId": "...",
      "documentPath": "documents/01-mcp-server-creation.md",
      "documentTitle": "–°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞",
      "content": "...",
      "similarity": 0.89,
      "chunkIndex": 0
    }
  ],
  "tokensUsed": 150
}
```

### 2. –û–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

**POST** `/api/rag/standard`

**Request:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?"
}
```

**Response:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "answer": "MCP —Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å...",
  "tokensUsed": 120
}
```

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–æ–≤

**POST** `/api/rag/compare`

**Request:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "topK": 3,
  "minSimilarity": 0.5
}
```

**Response:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "ragResponse": {
    "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
    "answer": "...",
    "contextChunks": [...],
    "tokensUsed": 150
  },
  "standardResponse": {
    "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
    "answer": "...",
    "tokensUsed": 120
  }
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `config/server.yaml`:

```yaml
server:
  port: 8080

ollama:
  baseUrl: "http://localhost:11434"  # URL Ollama —Å–µ—Ä–≤–µ—Ä–∞
  model: "nomic-embed-text"          # –ú–æ–¥–µ–ª—å –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
  timeout: 120000                    # –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (2 –º–∏–Ω—É—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤)

knowledgeBase:
  databasePath: "data/knowledge_base.db"  # –ü—É—Ç—å –∫ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

indexing:
  chunkSize: 400      # –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –≤ —Ç–æ–∫–µ–Ω–∞—Ö (—É–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ Ollama)
  overlapSize: 50     # –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ –≤ —Ç–æ–∫–µ–Ω–∞—Ö
  documentsPath: "documents"  # –ü–∞–ø–∫–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

ai:
  provider: "openrouter"
  apiKey: "${OPENAI_API_KEY}"  # –±–µ—Ä—ë—Ç—Å—è –∏–∑ .env
  model: "gpt-4o-mini"  # –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
  temperature: 0.7
  maxTokens: 2000
```

**–í `.env` (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞):**
```
OPENAI_API_KEY=your_openrouter_api_key
```

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** (`/indexing.html`) –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π:
- –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –î–æ–∫—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ —á–∞–Ω–∫–∏ (400 —Ç–æ–∫–µ–Ω–æ–≤ —Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º 50)
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ Ollama
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite

### –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É **–ü–æ–∏—Å–∫** (`/search.html`) –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞:
- –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å
- –°–∏—Å—Ç–µ–º–∞ –Ω–∞–π–¥—ë—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏
- –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –æ—Ü–µ–Ω–∫–æ–π —Å—Ö–æ–¥—Å—Ç–≤–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Markdown

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ RAG –∏ –æ–±—ã—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ RAG** (`/rag-compare.html`) –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤:
- –í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ)
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç –æ–±–∞ –æ—Ç–≤–µ—Ç–∞ —Ä—è–¥–æ–º (RAG —Å–ª–µ–≤–∞, –æ–±—ã—á–Ω—ã–π —Å–ø—Ä–∞–≤–∞)
- –û—Ç–æ–±—Ä–∞–∑–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —á–∞–Ω–∫–∏ –¥–ª—è RAG-–æ—Ç–≤–µ—Ç–∞

**–í–æ–ø—Ä–æ—Å:** "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?"

**RAG-–æ—Ç–≤–µ—Ç:**
```
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK
2. –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å Server
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
...
(–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏)
```

**–û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```
MCP —Å–µ—Ä–≤–µ—Ä –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π SDK...
(–æ–±—â–∏–µ –∑–Ω–∞–Ω–∏—è LLM)
```

**–í—ã–≤–æ–¥:** RAG –ø–æ–º–æ–≥ ‚Äî –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

### –ü—Ä–∏–º–µ—Ä 2: –û–±—â–∏–π –≤–æ–ø—Ä–æ—Å

**–í–æ–ø—Ä–æ—Å:** "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ?"

**RAG-–æ—Ç–≤–µ—Ç:**
```
–í –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏.
(LLM –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—â–∏—Ö –∑–Ω–∞–Ω–∏–π)
```

**–û–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```
–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º...
(–æ–±—â–∏–µ –∑–Ω–∞–Ω–∏—è LLM)
```

**–í—ã–≤–æ–¥:** RAG –Ω–µ –ø–æ–º–æ–≥ ‚Äî –≤–æ–ø—Ä–æ—Å –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

## üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ì–¥–µ RAG –ø–æ–º–æ–≥–∞–µ—Ç:

1. **–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
   - –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

2. **–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∑–Ω–∞–Ω–∏—è:**
   - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ü—Ä–æ–µ–∫—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã

### –ì–¥–µ RAG –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

1. **–í–æ–ø—Ä–æ—Å—ã –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
   - –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
   - –í–æ–ø—Ä–æ—Å—ã –Ω–µ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π

2. **–£—Å—Ç–∞—Ä–µ–≤—à–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
   - –î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã:

1. **–í–æ–ø—Ä–æ—Å—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ RAG –¥–æ–ª–∂–µ–Ω –ø–æ–º–æ—á—å:**
   - "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?"
   - "–ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ Ollama?"
   - "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤?"
   - "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ?"

2. **–í–æ–ø—Ä–æ—Å—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ RAG –º–æ–∂–µ—Ç –Ω–µ –ø–æ–º–æ—á—å:**
   - "–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â?" (–Ω–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö)
   - "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞?" (–Ω–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö)
   - –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ LLM –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π:**
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏)
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —á–∞–Ω–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º (–ø–æ–ª–µ `content`)

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Ollama:**
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –º–æ–¥–µ–ª—å `nomic-embed-text`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ OpenRouter:**
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω `OPENAI_API_KEY` –≤ `.env`
   - –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ `config/server.yaml` (–ø–∞—Ä–∞–º–µ—Ç—Ä `ai.model`)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **PROMPT.md** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
- **THEORY.md** ‚Äî —Ç–µ–æ—Ä–∏—è –ø–æ RAG, –ø–æ–∏—Å–∫—É, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **CHAT_PROMPT.txt** ‚Äî –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI –∞–≥–µ–Ω—Ç–∞

## üéì –¶–µ–ª–∏ —É—Ä–æ–∫–∞

- –ü–æ–¥–∫–ª—é—á–∏—Ç—å RAG –∫ LLM —á–µ—Ä–µ–∑ OpenRouter
- –ü–æ–Ω—è—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å RAG –∏ –±–µ–∑ RAG
- –°—Ä–∞–≤–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã —Å RAG –∏ –±–µ–∑ RAG
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –≤ –∞–≥–µ–Ω—Ç–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

- –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —É—Ä–æ–∫–∏ –ø–æ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç–µ —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [RAG: Retrieval-Augmented Generation (Paper)](https://arxiv.org/abs/2005.11401)
- [OpenRouter API Documentation](https://openrouter.ai/docs)
- [LangChain RAG Tutorial](https://python.langchain.com/docs/use_cases/question_answering/)
- [Ollama API Documentation](https://ollama.ai/docs/api)

