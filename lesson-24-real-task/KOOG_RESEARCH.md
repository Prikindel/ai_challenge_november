# Исследование Koog Framework

## Обзор

**Koog** — это открытый фреймворк от JetBrains для создания AI-агентов с использованием идиоматичного, типобезопасного Kotlin DSL, специально разработанного для JVM и Kotlin-разработчиков.

- **Документация:** https://docs.koog.ai/
- **Мультиплатформенная разработка:** JVM, JS, WasmJS, Android, iOS (Kotlin Multiplatform)

## Ключевые возможности

### Типы агентов

1. **Базовые агенты (Basic agents)** — обрабатывают один ввод и предоставляют ответ
2. **Функциональные агенты (Functional agents)** — легковесные агенты с пользовательской логикой на чистом Kotlin
3. **Агенты с комплексными рабочими процессами (Complex workflow agents)** — обрабатывают сложные рабочие процессы с пользовательскими стратегиями

### Основные функции

- **Промпты:** Создание промптов, выполнение с LLM-клиентами, переключение между LLM, обработка сбоев с повторными попытками
- **Инструменты (Tools):** 
  - Встроенные инструменты
  - Аннотационные инструменты (`@Tool` аннотации)
  - Классовые инструменты
- **Стратегии:** Проектирование сложного поведения агентов через графы рабочих процессов
- **События:** Мониторинг жизненного цикла агента
- **Сжатие истории:** Оптимизация использования токенов
- **Сохранение состояния:** Восстановление состояния агента в определенные моменты
- **Структурированный вывод:** Генерация ответов в структурированных форматах
- **Streaming API:** Обработка ответов в реальном времени
- **Извлечение знаний:** Векторные эмбеддинги, ранжированное хранение документов

## Интеграция с фреймворками

### Ktor

Koog предоставляет плагин для Ktor (`koog-ktor`):
- Идиоматичная интеграция Kotlin/Ktor для серверной разработки
- Настройка LLM-провайдеров через конфигурационные файлы
- Вызов агентов прямо из маршрутов
- Не нужно вручную связывать LLM-клиентов между модулями

### Spring Boot

Koog предоставляет стартер для Spring Boot (`koog-spring-boot-starter`):
- Автонастройка LLM-клиентов на основе свойств приложения
- Готовые бины для внедрения зависимостей
- Минимальная настройка

## Интеграции

- **Model Context Protocol (MCP):** Стандартизированный протокол для взаимодействия с внешними инструментами
- **OpenTelemetry:** Мониторинг и отладка с W&B Weave и Langfuse
- **LLM провайдеры:** OpenAI, Anthropic, Google, OpenRouter, DeepSeek, Ollama

## Начало работы

### Требования

- Kotlin/JVM проект с Gradle или Maven
- Java 17+
- API-ключ от LLM-провайдера (не требуется для Ollama)

### Зависимости

**Для базового использования:**
```kotlin
// Gradle
implementation("ai.jetbrains:koog-core:VERSION")
```

**Для Ktor интеграции:**
```kotlin
implementation("ai.jetbrains:koog-ktor:VERSION")
```

**Для Spring Boot:**
```kotlin
implementation("ai.jetbrains:koog-spring-boot-starter:VERSION")
```

**Примечание:** Точные координаты зависимостей нужно найти в документации или GitHub репозитории.

## Инструменты (Tools)

### Аннотационные инструменты (@Tool)

Koog поддерживает создание инструментов через аннотации:

```kotlin
@Tool("Описание инструмента")
fun toolName(@Param("param") param: String): ReturnType {
    // Реализация
}
```

Инструменты могут:
- Получать доступ к внешним системам и API
- Вызываться агентами во время выполнения
- Быть типобезопасными

## Примеры использования

### Базовый агент

```kotlin
// Пример структуры (нужно уточнить по документации)
val agent = BasicAgent.create {
    // Конфигурация агента
}
```

### Функциональный агент

```kotlin
// Пример структуры (нужно уточнить по документации)
val agent = FunctionalAgent.create {
    // Логика обработки
}
```

## Конфигурация LLM

Koog поддерживает конфигурацию LLM через:
- Файлы конфигурации (например, `application.conf` для Ktor)
- Программная конфигурация в коде
- Переключение между LLM без потери истории

## Тестирование

Koog предоставляет фреймворк для тестирования:
- Мокирование LLM-ответов
- Симуляция вызовов инструментов
- Контролируемые тестовые среды

## Дополнительные ресурсы

- **Getting started:** https://docs.koog.ai/getting-started/
- **Ktor Plugin:** https://docs.koog.ai/ktor-plugin/
- **Spring Boot:** https://docs.koog.ai/spring-boot/
- **Tools:** https://docs.koog.ai/tools/
- **Examples:** https://docs.koog.ai/examples/overview/
- **API Reference:** https://docs.koog.ai/api-reference/

## Важные замечания для проекта

1. **Зависимости:** Нужно найти точные координаты Maven/Gradle для Koog
2. **Версия:** Определить актуальную версию библиотеки
3. **Интеграция с Ktor:** Использовать `koog-ktor` для интеграции
4. **Инструменты:** Использовать `@Tool` аннотации для создания инструментов агента
5. **MCP:** Koog поддерживает MCP для интеграции с внешними сервисами

## Следующие шаги

1. Найти GitHub репозиторий Koog для получения точных зависимостей
2. Изучить примеры кода в документации
3. Проверить версию библиотеки
4. Изучить детали интеграции с Ktor
5. Изучить примеры использования `@Tool` аннотаций

