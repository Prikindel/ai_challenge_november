# üî• –î–µ–Ω—å 31. –ì–æ–ª–æ—Å–æ–≤–æ–π –∞–≥–µ–Ω—Ç (Speech ‚Üí LLM ‚Üí Text)

–ì–æ–ª–æ—Å–æ–≤–æ–π –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ Vosk, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ –ª–æ–∫–∞–ª—å–Ω—É—é LLM –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç.

## üé• –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

> üìπ –í–∏–¥–µ–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
1. –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"
2. –ü—Ä–æ–∏–∑–Ω–µ—Å–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤ –º–∏–∫—Ä–æ—Ñ–æ–Ω
3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
4. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —á–µ—Ä–µ–∑ Vosk
5. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é LLM
6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

## üéØ –¶–µ–ª—å —É—Ä–æ–∫–∞

–°–æ–∑–¥–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π:
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≥–æ–ª–æ—Å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –†–∞—Å–ø–æ–∑–Ω–∞—ë—Ç —Ä–µ—á—å —á–µ—Ä–µ–∑ Vosk (–ª–æ–∫–∞–ª—å–Ω–æ)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—É—é LLM (VPS)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
- –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ

## –ß—Ç–æ –¥–µ–ª–∞–µ–º

- –ë–µ—Ä–µ–º –ø—Ä–æ—Å—Ç–æ–π —á–∞—Ç –∫–∞–∫ –±–∞–∑—É (lesson-01 –∏–ª–∏ lesson-19)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Vosk –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
- –°–æ–∑–¥–∞—ë–º —Å–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
- –î–æ–±–∞–≤–ª—è–µ–º API endpoint –¥–ª—è –ø—Ä–∏—ë–º–∞ –∞—É–¥–∏–æ
- –°–æ–∑–¥–∞—ë–º UI –¥–ª—è –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–∞
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Å –ª–æ–∫–∞–ª—å–Ω–æ–π LLM
- –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

## –ü–∞–π–ø–ª–∞–π–Ω

1. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî –∫–æ–ø–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π —á–∞—Ç (lesson-01 –∏–ª–∏ lesson-19)
2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vosk** ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫–∞—á–∏–≤–∞–µ–º –º–æ–¥–µ–ª—å
3. **–°–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è** ‚Äî —Å–æ–∑–¥–∞—ë–º SpeechRecognitionService
4. **API endpoint** ‚Äî —Å–æ–∑–¥–∞—ë–º VoiceController –¥–ª—è –ø—Ä–∏—ë–º–∞ –∞—É–¥–∏–æ
5. **Frontend** ‚Äî —Å–æ–∑–¥–∞—ë–º UI –¥–ª—è –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–∞
6. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∞—É–¥–∏–æ** ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é –≤ —Ñ–æ—Ä–º–∞—Ç Vosk
7. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è LLM** ‚Äî –ø–æ–¥–∫–ª—é—á–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é LLM –∏–∑ —É—Ä–æ–∫–∞ 28
8. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ–º –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
9. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî —Å–æ–∑–¥–∞—ë–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 17+
- Gradle 8+
- ffmpeg (–¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞—É–¥–∏–æ)
- –õ–æ–∫–∞–ª—å–Ω–∞—è LLM –Ω–∞ VPS (–∏–∑ —É—Ä–æ–∫–∞ 28)

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vosk –º–æ–¥–µ–ª–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –º–æ–¥–µ–ª–µ–π
mkdir -p models

# –°–∫–∞—á–∞—Ç—å —Ä—É—Å—Å–∫—É—é –º–æ–¥–µ–ª—å
cd models
wget https://alphacephei.com/vosk/models/vosk-model-small-ru-0.22.zip

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å
unzip vosk-model-small-ru-0.22.zip
```

**–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:** —Å–º. [`VOSK_SETUP.md`](./VOSK_SETUP.md)

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ffmpeg

**macOS:**
```bash
brew install ffmpeg
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install ffmpeg
```

**Windows:**
```bash
choco install ffmpeg
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**config/server.yaml:**
```yaml
speechRecognition:
  enabled: true
  provider: "vosk"
  modelPath: "models/vosk-model-small-ru-0.22"
  sampleRate: 16000

localLLM:
  enabled: true
  provider: "ollama"
  baseUrl: "https://185.31.165.227"  # VPS –∏–∑ —É—Ä–æ–∫–∞ 28
  model: "llama3.2"
  auth:
    type: "basic"
    user: "user"
    password: "pass"
```

### 5. –ó–∞–ø—É—Å–∫

```bash
cd server
./gradlew build
./gradlew run
```

–û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:8080/voice.html`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
2. –ù–∞–∂–º–∏—Ç–µ "üé§ –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å"
3. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
4. –ü—Ä–æ–∏–∑–Ω–µ—Å–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É
5. –ù–∞–∂–º–∏—Ç–µ "‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å"
6. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ—Ç–≤–µ—Ç–∞

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

- "–ü–æ—Å—á–∏—Ç–∞–π 2 –ø–ª—é—Å 2"
- "–î–∞–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞"
- "–°–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç"
- "–ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?"
- "–û–±—ä—è—Å–Ω–∏ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É async –∏ await"

## API Endpoints

### POST /api/voice/recognize

–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –∏–∑ –∞—É–¥–∏–æ.

**–ó–∞–ø—Ä–æ—Å:**
- `multipart/form-data`
- –ü–æ–ª–µ `audio`: –∞—É–¥–∏–æ —Ñ–∞–π–ª (webm, wav)

**–û—Ç–≤–µ—Ç:**
```json
{
  "text": "—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç",
  "status": "success"
}
```

### POST /api/voice/process

–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ‚Üí LLM ‚Üí –æ—Ç–≤–µ—Ç.

**–ó–∞–ø—Ä–æ—Å:**
- `multipart/form-data`
- –ü–æ–ª–µ `audio`: –∞—É–¥–∏–æ —Ñ–∞–π–ª

**–û—Ç–≤–µ—Ç:**
```json
{
  "recognizedText": "–ø–æ—Å—á–∏—Ç–∞–π 2 –ø–ª—é—Å 2",
  "response": "2 –ø–ª—é—Å 2 —Ä–∞–≤–Ω–æ 4",
  "status": "success"
}
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
[–ë—Ä–∞—É–∑–µ—Ä]
  ‚Üì Web Audio API (–∑–∞–ø–∏—Å—å)
[MediaRecorder] ‚Üí audio.webm
  ‚Üì POST /api/voice/process
[Ktor Server]
  ‚Üì
[AudioConversionService] ‚Üí –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WAV 16kHz
  ‚Üì
[SpeechRecognitionService] ‚Üí Vosk —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
  ‚Üì —Ç–µ–∫—Å—Ç
[LLMService] ‚Üí –ª–æ–∫–∞–ª—å–Ω–∞—è LLM (VPS)
  ‚Üì –æ—Ç–≤–µ—Ç
[Response] ‚Üí JSON —Å —Ç–µ–∫—Å—Ç–æ–º
  ‚Üì
[–ë—Ä–∞—É–∑–µ—Ä] ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∞—É–¥–∏–æ

### –§–æ—Ä–º–∞—Ç –¥–ª—è Vosk

- **–§–æ—Ä–º–∞—Ç:** WAV, 16-bit PCM
- **Sample rate:** 16 kHz
- **–ö–∞–Ω–∞–ª—ã:** Mono (1 –∫–∞–Ω–∞–ª)
- **–†–∞–∑–º–µ—Ä:** –¥–æ 10 –ú–ë

### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

–ê—É–¥–∏–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ (webm) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç Vosk —á–µ—Ä–µ–∑ ffmpeg.

## –§–∞–π–ª—ã —É—Ä–æ–∫–∞

- `PROMPT.md` ‚Äî –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ –∫–æ–º–º–∏—Ç–∞–º)
- `README.md` ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª
- `VOSK_SETUP.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Vosk
- `CHAT_PROMPT.txt` ‚Äî –∫—Ä–∞—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–∞
- `TESTING.md` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üí° –°–æ–≤–µ—Ç—ã

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Ñ–æ–Ω** ‚Äî –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ = –ª—É—á—à–µ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
2. **–ì–æ–≤–æ—Ä–∏—Ç–µ —á—ë—Ç–∫–æ** ‚Äî –º–µ–¥–ª–µ–Ω–Ω–∞—è, —á—ë—Ç–∫–∞—è —Ä–µ—á—å —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –ª—É—á—à–µ
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥–µ–ª—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –≤–∞—à–µ–≥–æ —è–∑—ã–∫–∞
4. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ffmpeg** ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ffmpeg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

### –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ–ª—å Vosk —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ (16kHz, mono)

### ffmpeg –Ω–µ –Ω–∞–π–¥–µ–Ω

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ffmpeg: `brew install ffmpeg` (macOS) –∏–ª–∏ `apt install ffmpeg` (Linux)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ffmpeg –≤ PATH: `ffmpeg -version`

### LLM –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPS
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è LLM –∑–∞–ø—É—â–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

- **–£—Ä–æ–∫ 1/19** ‚Äî –ø—Ä–æ—Å—Ç–æ–π —á–∞—Ç (–±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- **–£—Ä–æ–∫ 28** ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è LLM –Ω–∞ VPS (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤)

