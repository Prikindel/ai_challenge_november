# üî• –î–µ–Ω—å 8. –°–∂–∞—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞

## –¶–µ–ª—å –º–æ–¥—É–ª—è

–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —É—á–µ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º –∞–≥–µ–Ω—Ç –≤–µ–¥—ë—Ç –¥–∏–∞–ª–æ–≥ —Å LLM, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —ç–∫–æ–Ω–æ–º–∏—é —Ç–æ–∫–µ–Ω–æ–≤. –£—á–µ–±–Ω–∞—è —Ü–µ–ª—å ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –Ω–µ —Ç–µ—Ä—è—è –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤.

## –ö—Ä–∞—Ç–∫–∞—è —Ç–µ–æ—Ä–∏—è

- **–ü–æ—á–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ—Ä–æ–≥–æ–π.** –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é: –ø—Ä–æ–º–ø—Ç —Ä–∞—Å—Ç—ë—Ç, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞. –ß–µ–º –≥–ª—É–±–∂–µ –¥–∏–∞–ª–æ–≥, —Ç–µ–º –¥–æ—Ä–æ–∂–µ –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.
- **Rolling Summary.** –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–≤–æ–¥–∫—É. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–º—ã—Å–ª, —É–±–∏—Ä–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏, –æ—Ç–¥–∞—ë–º –≤ –º–æ–¥–µ–ª—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç.
- **Retrieval-based.** –§–∞–∫—Ç—ã –∏ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ (–≤ –ø–∞–º—è—Ç—å/–±–∞–∑—É), –∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –≤—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.
- **Hybrid.** –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º summary –∏ retrieval: summary –¥–∞—ë—Ç –æ–±–∑–æ—Ä, retrieval –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—á–Ω—ã–µ —Ñ–∞–∫—Ç—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã.** –ß–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ —Å–∂–∞—Ç–∏–µ, —Ç–µ–º –≤—ã—à–µ —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –Ω—é–∞–Ω—Å–æ–≤. Summary –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å, –∫–æ–≥–¥–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ —Ñ–∞–∫—Ç—ã. –û—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∏—Å–∫ ‚Äî –∏—Å–∫–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- **–ú–µ—Ç—Ä–∏–∫–∏.** –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –ø—Ä–æ–º–ø—Ç–∞ (prompt tokens), —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏—á–µ—Å–∫—É—é —Å–≤—è–∑–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
lesson-08-dialog-compression/
‚îú‚îÄ‚îÄ README.md                 # –¢–µ–æ—Ä–∏—è, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îú‚îÄ‚îÄ example.env               # –®–∞–±–ª–æ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ compression.yaml      # –ò–Ω—Ç–µ—Ä–≤–∞–ª summary, –ª–∏–º–∏—Ç—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îú‚îÄ‚îÄ server/                   # Kotlin + Ktor + Clean Architecture
‚îî‚îÄ‚îÄ client/                   # Vanilla JS –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–±—É–¥–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –Ω–∞ —ç—Ç–∞–ø–µ 3)
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `example.env` –≤ `.env` –≤–Ω—É—Ç—Ä–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —É—Ä–æ–∫–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `OPENAI_API_KEY`.
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –ª–µ–∂–∞—Ç –≤ `config/compression.yaml`:
   - `summaryInterval` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–µ–¥—ë–º –≤ "—Å—ã—Ä–æ–º" –≤–∏–¥–µ –ø–µ—Ä–µ–¥ —Å–∂–∞—Ç–∏–µ–º.
   - `maxSummariesInContext` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ summary-–±–ª–æ–∫–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –∑–∞–ø—Ä–æ—Å–µ.
   - `rawHistoryLimit` ‚Äî –≥–ª—É–±–∏–Ω–∞ –Ω–µ—Å–∂–∞—Ç–æ–π –∏—Å—Ç–æ—Ä–∏–∏.
   - `compressionModel` –∏ `compressionPromptTemplate` ‚Äî –º–æ–¥–µ–ª—å –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è —Å–≤—ë—Ä—Ç–∫–∏.
   - `scenarios` ‚Äî –ø—Ä–µ–¥–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –¥–µ–º–æ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

## –°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (–±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–∑–¥–Ω–µ–µ)

- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (`./gradlew run`) –∏ –æ—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- –í–µ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥ –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ, –Ω–∞–±–ª—é–¥–∞—è –ø–µ—Ä–µ—Ö–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ summary.
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω: –±–µ–∑ —Å–∂–∞—Ç–∏—è –∏ —Å —Å–∂–∞—Ç–∏–µ–º, —Å—Ä–∞–≤–Ω–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏.
- –ò–∑—É—á–∏—Ç—å –∂—É—Ä–Ω–∞–ª summary-–±–ª–æ–∫–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏ –∏ –æ—Ç—á—ë—Ç –æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–µ—Ä–µ–¥–∞–Ω –≤ –º–æ–¥–µ–ª—å.

## –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞ (–±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω)

```bash
cd lesson-08-dialog-compression/server
./gradlew clean run
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç–∞ –∏ API –¥–ª—è –¥–∏–∞–ª–æ–≥–∞. UI –æ–ø–∏—Å–∞–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ "–§—Ä–æ–Ω—Ç–µ–Ω–¥" –∏ –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —ç—Ç–∞–ø–µ.

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

1. **–°–µ—Ä–≤–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞:** –∞–≥–µ–Ω—Ç –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, DTO, —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.
2. **–§—Ä–æ–Ω—Ç–µ–Ω–¥:** –¥–∏–∞–ª–æ–≥–æ–≤—ã–π UI, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è summary –∏ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–ø—É—Å–∫–æ–≤.
3. **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –ø—Ä–æ–≥–æ–Ω —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É.
