# üß† –¢–µ–æ—Ä–∏—è: MCP –∏ LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## –ß—Ç–æ —Ç–∞–∫–æ–µ MCP Server?

**MCP Server** ‚Äî —ç—Ç–æ —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (tools), —Ä–µ—Å—É—Ä—Å—ã (resources) –∏ –ø—Ä–æ–º–ø—Ç—ã (prompts) –¥–ª—è LLM —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª. MCP Server –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ –ª—é–±–æ–º —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ª—é–±—ã–º –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MCP Server:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MCP Client  ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ MCP Server  ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ External    ‚îÇ
‚îÇ (–Ω–∞—à–µ       ‚îÇ         ‚îÇ (–Ω–∞—à –∫–æ–¥)   ‚îÇ         ‚îÇ API/Service ‚îÇ
‚îÇ  –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)‚îÇ         ‚îÇ             ‚îÇ         ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã MCP Server:

1. **Server** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ Kotlin SDK
2. **Tools** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç
3. **Transport** ‚Äî —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö (stdio, SSE, WebSocket)
4. **API Client** ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º API

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª MCP Server:

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞
2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (stdio)
4. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞
5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
6. –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç—É

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è MCP —Å LLM (Function Calling)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É MCP –∏ LLM:**

MCP —Å–µ—Ä–≤–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (tools), –∫–æ—Ç–æ—Ä—ã–µ LLM –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º **function calling** (—Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ–º—ã–π "tools" –≤ OpenAI API). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç LLM —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ—à–∞—Ç—å, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—ã–∑—ã–≤–∞—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   User      ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  LLM Agent  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  LLM API    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  MCP Client ‚îÇ
‚îÇ  (Chat)     ‚îÇ    ‚îÇ             ‚îÇ    ‚îÇ (OpenRouter)‚îÇ    ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                               ‚îÇ
                                                               ‚ñº
                                                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                         ‚îÇ MCP Server  ‚îÇ
                                                         ‚îÇ  (Tools)    ‚îÇ
                                                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã (Function Calling Cycle):

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - MCP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
   - MCP –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
   - –ü–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`listTools()`)
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ MCP –≤ —Ñ–æ—Ä–º–∞—Ç OpenAI (JSON Schema)

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - –°–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ LLM Agent
   - LLM Agent —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ LLM API —Å:
     - –ò—Å—Ç–æ—Ä–∏–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π
     - –°–ø–∏—Å–∫–æ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`tools`)
     - –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–º `tool_choice = "auto"` (LLM —Å–∞–º —Ä–µ—à–∞–µ—Ç, –≤—ã–∑—ã–≤–∞—Ç—å –ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)

3. **LLM —Ä–µ—à–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:**
   - LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram), LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å `tool_calls`
   - –í –æ—Ç–≤–µ—Ç–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:
     - `tool_call_id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≤—ã–∑–æ–≤–∞
     - `function.name` ‚Äî –∏–º—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
     - `function.arguments` ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å—Ç—Ä–æ–∫–∏

4. **–í—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ MCP:**
   - LLM Agent –ø–∞—Ä—Å–∏—Ç `tool_calls` –∏–∑ –æ—Ç–≤–µ—Ç–∞ LLM
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞:
     - –ü–∞—Ä—Å—è—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏–∑ JSON —Å—Ç—Ä–æ–∫–∏
     - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ MCP Client (`callTool()`)
     - MCP Client –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ MCP Server
     - MCP Server –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram)
     - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ

5. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM:**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `role = "tool"`
   - –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ LLM —Å–Ω–æ–≤–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π
   - LLM –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

6. **–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**
   - –ü—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (–¥–æ 5 –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - LLM –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
   - –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –±–µ–∑ `tool_calls`

## –ü–æ—á–µ–º—É `tool_choice = "auto"`? –†–∞–∑–±–æ—Ä —Ä–∞–±–æ—Ç—ã —Ü–∏–∫–ª–∞ –≤—ã–∑–æ–≤–æ–≤

**–í–∞–∂–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:** `tool_choice = "auto"` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **LLM –°–ê–ú —Ä–µ—à–∞–µ—Ç**, –Ω—É–∂–Ω–æ –ª–∏ –≤—ã–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –ö–æ–¥ –Ω–µ "–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç—É–ª–∑—É —Å–∞–º" ‚Äî –æ–Ω —Ç–æ–ª—å–∫–æ **–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ LLM** –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `tool_choice = "auto"`:

1. **LLM –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
   ```kotlin
   // –í LLMWithMCPAgent.kt
   val openAITools = convertMCPToolsToOpenAI(mcpTools)
   // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ LLM API:
   // tools: [ToolDto("get_bot_info", ...), ToolDto("send_message", ...)]
   // tool_choice: "auto"  ‚Üê LLM —Å–∞–º —Ä–µ—à–∞–µ—Ç!
   ```

2. **LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–û—Ç–ø—Ä–∞–≤—å —Å–æ–æ–±—â–µ–Ω–∏–µ '–ü—Ä–∏–≤–µ—Ç' –≤ —á–∞—Ç 123456789"
   - LLM –≤–∏–¥–∏—Ç: –µ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `send_message` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `chatId` –∏ `text`
   - LLM —Ä–µ—à–∞–µ—Ç: "–ú–Ω–µ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å `send_message` —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"
   - LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å `tool_calls` (–ù–ï —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç!)

3. **–ö–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ LLM:**
   ```kotlin
   // LLM –≤–µ—Ä–Ω—É–ª:
   {
     "role": "assistant",
     "tool_calls": [{
       "id": "call_123",
       "function": {
         "name": "send_message",
         "arguments": "{\"chatId\":\"123456789\",\"text\":\"–ü—Ä–∏–≤–µ—Ç\"}"
       }
     }]
   }
   
   // –ö–æ–¥ –ù–ï —Ä–µ—à–∞–µ—Ç —Å–∞–º - –æ–Ω —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ LLM:
   if (assistantMessage.toolCalls != null) {
       // LLM —Ä–µ—à–∏–ª –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç - –≤—ã–ø–æ–ª–Ω—è–µ–º –µ–≥–æ —Ä–µ—à–µ–Ω–∏–µ
       val toolCall = assistantMessage.toolCalls.first()
       val arguments = json.decodeFromString<Map<String, Any>>(toolCall.function.arguments)
       val result = mcpToolAgent.callTool(toolCall.function.name, arguments)
   }
   ```

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM:**
   ```kotlin
   // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é:
   messages.add(MessageDto(
       role = "tool",
       content = result.result,  // "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {...}"
       toolCallId = toolCall.id
   ))
   
   // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ LLM —Å–Ω–æ–≤–∞ (–ë–ï–ó tool_choice, —á—Ç–æ–±—ã LLM –º–æ–≥ –¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç)
   val finalResponse = aiRepository.getMessageWithTools(messages, openAITools)
   ```

5. **LLM —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:**
   - LLM –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
   - LLM –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
   - LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–ë–ï–ó `tool_calls`)

### –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É `tool_choice` –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ü–æ–≤–µ–¥–µ–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|----------|-----------|-------------------|
| `"auto"` | LLM —Å–∞–º —Ä–µ—à–∞–µ—Ç, –≤—ã–∑—ã–≤–∞—Ç—å –ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—Å—Ç –∏–ª–∏ `tool_calls` | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ |
| `"required"` | LLM –û–ë–Ø–ó–ê–ù –≤—ã–∑–≤–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –í—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–µ—Ç `tool_calls` | –ö–æ–≥–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö) |
| `"none"` | LLM –ù–ï –ú–û–ñ–ï–¢ –≤—ã–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. –í—Å–µ–≥–¥–∞ –≤–µ—Ä–Ω–µ—Ç —Ç–µ–∫—Å—Ç | –ö–æ–≥–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã |
| `{"type": "function", "function": {"name": "tool_name"}}` | LLM –û–ë–Ø–ó–ê–ù –≤—ã–∑–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç |

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –≤—ã–∑–æ–≤–æ–≤:

```
–®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí "–û—Ç–ø—Ä–∞–≤—å '–ü—Ä–∏–≤–µ—Ç' –≤ —á–∞—Ç 123456789"
        ‚Üì
–®–∞–≥ 2: LLM Agent ‚Üí –ó–∞–ø—Ä–æ—Å –∫ LLM API:
        {
          "messages": [{"role": "user", "content": "–û—Ç–ø—Ä–∞–≤—å '–ü—Ä–∏–≤–µ—Ç' –≤ —á–∞—Ç 123456789"}],
          "tools": [{"name": "send_message", ...}],
          "tool_choice": "auto"  ‚Üê LLM —Ä–µ—à–∞–µ—Ç —Å–∞–º!
        }
        ‚Üì
–®–∞–≥ 3: LLM API ‚Üí –†–µ—à–µ–Ω–∏–µ LLM:
        {
          "role": "assistant",
          "tool_calls": [{
            "id": "call_123",
            "function": {"name": "send_message", "arguments": "{\"chatId\":\"123456789\",\"text\":\"–ü—Ä–∏–≤–µ—Ç\"}"}
          }]
        }
        ‚Üì
–®–∞–≥ 4: LLM Agent ‚Üí –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ—à–µ–Ω–∏–µ LLM:
        mcpToolAgent.callTool("send_message", {"chatId": "123456789", "text": "–ü—Ä–∏–≤–µ—Ç"})
        ‚Üì
–®–∞–≥ 5: MCP Server ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram
        ‚Üì
–®–∞–≥ 6: MCP Server ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
        "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {...}"
        ‚Üì
–®–∞–≥ 7: LLM Agent ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM:
        {
          "messages": [
            {"role": "user", "content": "–û—Ç–ø—Ä–∞–≤—å '–ü—Ä–∏–≤–µ—Ç' –≤ —á–∞—Ç 123456789"},
            {"role": "assistant", "tool_calls": [...]},
            {"role": "tool", "content": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {...}", "tool_call_id": "call_123"}
          ],
          "tools": [...],
          "tool_choice": "auto"  ‚Üê –¢–µ–ø–µ—Ä—å LLM –º–æ–∂–µ—Ç –¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        }
        ‚Üì
–®–∞–≥ 8: LLM API ‚Üí –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:
        {
          "role": "assistant",
          "content": "–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram —á–∞—Ç 123456789!"
        }
        ‚Üì
–®–∞–≥ 9: LLM Agent ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** –ö–æ–¥ –Ω–µ "–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç—É–ª–∑—É —Å–∞–º". –û–Ω —Ç–æ–ª—å–∫–æ:
1. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç LLM —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ LLM –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ MCP
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

**LLM ‚Äî —ç—Ç–æ "–º–æ–∑–≥", –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è. –ö–æ–¥ ‚Äî —ç—Ç–æ "—Ä—É–∫–∏", –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–µ—à–µ–Ω–∏—è.**

## –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ MCP Tools –≤ OpenAI Format

MCP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON Schema –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (`inputSchema`). OpenAI API —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JSON Schema –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ. –ú—ã –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º `inputSchema` –æ—Ç MCP –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

**MCP Format:**
```json
{
  "type": "object",
  "properties": {
    "chatId": { "type": "string" },
    "text": { "type": "string" }
  },
  "required": ["chatId", "text"]
}
```

**OpenAI Format:**
```json
{
  "type": "function",
  "function": {
    "name": "send_message",
    "description": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram —á–∞—Ç",
    "parameters": {
      "type": "object",
      "properties": {
        "chatId": { "type": "string" },
        "text": { "type": "string" }
      },
      "required": ["chatId", "text"]
    }
  }
}
```

–§—É–Ω–∫—Ü–∏—è `convertMCPToolsToOpenAI()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è `inputSchema` –æ—Ç MCP —Å–µ—Ä–≤–µ—Ä–∞.

## –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∫–æ–¥–∞: –≥–¥–µ –∏ –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ):

```kotlin
// –í Main.kt –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
val mcpClient = MCPClient()
val mcpToolAgent = MCPToolAgent(mcpClient)

// –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
val mcpTools = mcpToolAgent.getAvailableTools()  // –ü–æ–ª—É—á–∞–µ–º –æ—Ç MCP —Å–µ—Ä–≤–µ—Ä–∞
val openAITools = convertMCPToolsToOpenAI(mcpTools)  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç OpenAI
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ LLM —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:

```kotlin
// –í LLMWithMCPAgent.kt:
val completionResult = aiRepository.getMessageWithTools(messages, openAITools)

// –í OpenAIClient.kt:
toolChoice = if (tools != null && tools.isNotEmpty()) "auto" else null
// ‚Üë LLM —Å–∞–º —Ä–µ—à–∞–µ—Ç, –≤—ã–∑—ã–≤–∞—Ç—å –ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç!
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ LLM:

```kotlin
// –í LLMWithMCPAgent.kt:
var assistantMessage = completionResult.response.choices.firstOrNull()?.message

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–µ—à–∏–ª –ª–∏ LLM –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:
while (assistantMessage.toolCalls != null && assistantMessage.toolCalls!!.isNotEmpty()) {
    // LLM —Ä–µ—à–∏–ª –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç - –≤—ã–ø–æ–ª–Ω—è–µ–º –µ–≥–æ —Ä–µ—à–µ–Ω–∏–µ
    for (toolCall in assistantMessage.toolCalls!!) {
        // –ü–∞—Ä—Å–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ LLM –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª:
        val arguments = json.decodeFromString<Map<String, Any>>(toolCall.function.arguments)
        
        // –í—ã–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ MCP (–≤—ã–ø–æ–ª–Ω—è–µ–º —Ä–µ—à–µ–Ω–∏–µ LLM):
        val result = mcpToolAgent.callTool(toolCall.function.name, arguments)
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è LLM:
        updatedMessages.add(MessageDto(
            role = "tool",
            content = result.result,
            toolCallId = toolCall.id
        ))
    }
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ LLM:
    completionResult = aiRepository.getMessageWithTools(updatedMessages, openAITools)
    assistantMessage = completionResult.response.choices.firstOrNull()?.message
    // ‚Üë LLM —Ç–µ–ø–µ—Ä—å –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∏ –º–æ–∂–µ—Ç –¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
}
```

### 4. –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:

```kotlin
// –ö–æ–≥–¥–∞ LLM –≤–µ—Ä–Ω—É–ª —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç (–±–µ–∑ tool_calls):
val finalMessage = assistantMessage.content  // "–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!"
return AgentResponse.Success(message = finalMessage, toolUsed = "send_message", ...)
```

### –ü–æ—á–µ–º—É —Ü–∏–∫–ª –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑?

LLM –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

```
–ó–∞–ø—Ä–æ—Å: "–ü–æ–ª—É—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å –µ—ë –≤ —á–∞—Ç 123456789"

–ò—Ç–µ—Ä–∞—Ü–∏—è 1: LLM ‚Üí tool_call: get_bot_info
            ‚Üì
            –†–µ–∑—É–ª—å—Ç–∞—Ç: {"id": 123, "username": "my_bot", ...}
            ‚Üì
–ò—Ç–µ—Ä–∞—Ü–∏—è 2: LLM ‚Üí tool_call: send_message (—Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º get_bot_info)
            ‚Üì
            –†–µ–∑—É–ª—å—Ç–∞—Ç: "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
            ‚Üì
–ò—Ç–µ—Ä–∞—Ü–∏—è 3: LLM ‚Üí content: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ —á–∞—Ç!"
            ‚Üì
            –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:

```kotlin
// –í LLMWithMCPAgent.kt:
var iterationCount = 0
val maxIterations = 5  // –ú–∞–∫—Å–∏–º—É–º 5 –∏—Ç–µ—Ä–∞—Ü–∏–π

while (assistantMessage.toolCalls != null && iterationCount < maxIterations) {
    iterationCount++
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ tool_calls ...
}
```

–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ LLM –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±–µ–∑ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.

## –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

MCP —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è **–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**, –∞ –Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** ‚Äî –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** ‚Äî —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑

–í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
- MCP —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–µ—Å–ª–∏ `mcp.autoStart = true` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
- –ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API endpoint `/api/mcp/connect`
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

## –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å MCP

1. **–û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∏–µ–Ω—Ç–∞** ‚Äî `MCPClient` —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
2. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî `connectToServer()` –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–∞—Ö (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç `isConnected()`)
3. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `isConnected`
4. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ** ‚Äî `disconnect()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** ‚Äî —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ—Ç MCP —Å–µ—Ä–≤–µ—Ä–∞, –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞

