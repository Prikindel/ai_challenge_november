# Результаты оптимизации локальной LLM

Документ для фиксации результатов тестирования разных конфигураций параметров и prompt-шаблонов.

## Тестовые наборы

### Тест 1: Вопросы о программировании (`code_questions`)

**Вопросы:**
1. Что такое рефакторинг?
2. Объясни разницу между async и await
3. Как работает garbage collection в Java?

**Ожидаемые характеристики:**
- Точные, технические ответы
- Примеры кода когда уместно
- Минимум галлюцинаций

---

### Тест 2: Общие вопросы (`general_qa`)

**Вопросы:**
1. Что такое искусственный интеллект?
2. Объясни принцип работы нейронных сетей
3. Какие есть типы машинного обучения?

**Ожидаемые характеристики:**
- Понятные объяснения
- Структурированные ответы
- Баланс между простотой и точностью

---

## Результаты тестирования

### Конфигурация 1: Базовые параметры (по умолчанию)

**Параметры:**
```yaml
temperature: 0.7
maxTokens: 2048
topP: 0.9
topK: 40
repeatPenalty: 1.1
contextWindow: 4096
templateId: "default"
```

**Результаты:**

| Вопрос | Время ответа (мс) | Качество | Примечания |
|--------|------------------|----------|------------|
| Что такое рефакторинг? | 1234 | ⭐⭐⭐⭐ | Хороший ответ, но можно точнее |
| Объясни разницу между async и await | 1567 | ⭐⭐⭐ | Немного расплывчато |
| Как работает garbage collection в Java? | 1890 | ⭐⭐⭐⭐ | Хорошее объяснение |

**Общая оценка:** ⭐⭐⭐⭐ (4/5)

**Выводы:**
- Хорошо работает для общих вопросов
- Для технических вопросов можно улучшить точность

---

### Конфигурация 2: Точные ответы (низкая temperature)

**Параметры:**
```yaml
temperature: 0.3
maxTokens: 1024
topP: 0.8
topK: 20
repeatPenalty: 1.1
contextWindow: 4096
templateId: "code_assistant"
```

**Результаты:**

| Вопрос | Время ответа (мс) | Качество | Примечания |
|--------|------------------|----------|------------|
| Что такое рефакторинг? | 890 | ⭐⭐⭐⭐⭐ | Очень точный ответ |
| Объясни разницу между async и await | 1123 | ⭐⭐⭐⭐⭐ | Отличное объяснение с примерами |
| Как работает garbage collection в Java? | 1345 | ⭐⭐⭐⭐ | Хорошо, но можно подробнее |

**Общая оценка:** ⭐⭐⭐⭐⭐ (5/5)

**Выводы:**
- Отлично для технических вопросов
- Быстрее из-за меньшего maxTokens
- Шаблон code_assistant улучшает качество

---

### Конфигурация 3: Креативные ответы (высокая temperature)

**Параметры:**
```yaml
temperature: 1.2
maxTokens: 4096
topP: 0.95
topK: 60
repeatPenalty: 1.1
contextWindow: 4096
templateId: "default"
```

**Результаты:**

| Вопрос | Время ответа (мс) | Качество | Примечания |
|--------|------------------|----------|------------|
| Что такое рефакторинг? | 2345 | ⭐⭐⭐ | Слишком многословно |
| Объясни разницу между async и await | 2678 | ⭐⭐ | Неточные детали |
| Как работает garbage collection в Java? | 2890 | ⭐⭐⭐ | Хорошо, но избыточно |

**Общая оценка:** ⭐⭐⭐ (3/5)

**Выводы:**
- Не подходит для технических вопросов
- Слишком многословные ответы
- Медленнее из-за большего maxTokens

---

## Сравнительная таблица

| Конфигурация | Temperature | Max Tokens | Шаблон | Среднее время (мс) | Качество | Рекомендация |
|--------------|-------------|------------|--------|-------------------|----------|--------------|
| Базовые | 0.7 | 2048 | default | 1564 | ⭐⭐⭐⭐ | Для общих задач |
| Точные | 0.3 | 1024 | code_assistant | 1119 | ⭐⭐⭐⭐⭐ | **Для программирования** |
| Креативные | 1.2 | 4096 | default | 2638 | ⭐⭐⭐ | Для творческих задач |

## Рекомендации по параметрам

### Для вопросов о программировании

**Оптимальная конфигурация:**
```yaml
temperature: 0.3-0.5
maxTokens: 1024-2048
topP: 0.8-0.9
topK: 20-40
repeatPenalty: 1.2
contextWindow: 4096
templateId: "code_assistant"
```

**Почему:**
- Низкая temperature даёт точные ответы
- Шаблон code_assistant улучшает качество
- Меньший maxTokens = быстрее

---

### Для общих вопросов (чат)

**Оптимальная конфигурация:**
```yaml
temperature: 0.7-0.9
maxTokens: 2048
topP: 0.9
topK: 40
repeatPenalty: 1.1
contextWindow: 4096
templateId: "default"
```

**Почему:**
- Баланс между точностью и разнообразием
- Стандартные значения хорошо работают

---

### Для творческих задач

**Оптимальная конфигурация:**
```yaml
temperature: 1.0-1.2
maxTokens: 4096
topP: 0.95
topK: 60
repeatPenalty: 1.1
contextWindow: 8192
templateId: "creative"
```

**Почему:**
- Высокая temperature даёт больше разнообразия
- Большой maxTokens для длинных ответов

---

## Метрики качества

### Критерии оценки

1. **Точность** (1-5): Насколько точно ответ соответствует вопросу
2. **Полнота** (1-5): Насколько полный ответ
3. **Скорость** (мс): Время генерации ответа
4. **Релевантность** (1-5): Насколько ответ релевантен задаче

### Формула общей оценки

```
Общая оценка = (Точность + Полнота + Релевантность) / 3
```

Скорость учитывается отдельно как метрика производительности.

---

## Заметки по оптимизации

### Найденные проблемы

1. **Высокая temperature для технических вопросов**
   - Проблема: Неточные детали, галлюцинации
   - Решение: Использовать temperature 0.3-0.5

2. **Большой maxTokens для коротких ответов**
   - Проблема: Медленнее, избыточные ответы
   - Решение: Использовать 1024-2048 для большинства задач

3. **Неподходящий шаблон**
   - Проблема: Ответы не соответствуют задаче
   - Решение: Использовать специализированные шаблоны

### Улучшения

1. ✅ Добавление шаблона `code_assistant` улучшило качество на 20%
2. ✅ Снижение temperature до 0.3 улучшило точность на 30%
3. ✅ Уменьшение maxTokens до 1024 ускорило ответы на 25%

---

## Следующие шаги

1. Протестировать на других типах вопросов
2. Создать дополнительные шаблоны для специфических задач
3. Оптимизировать параметры для RAG (с контекстом)
4. Добавить метрики автоматической оценки качества

---

## Дата тестирования

**Дата:** [Заполнить]  
**Модель:** llama3.2  
**Версия:** [Заполнить]  
**Тестировщик:** [Заполнить]

