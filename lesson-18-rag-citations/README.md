# üî• –î–µ–Ω—å 18. –¶–∏—Ç–∞—Ç—ã –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

–î–æ—Ä–∞–±–æ—Ç–∫–∞ RAG-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è —Ü–∏—Ç–∞—Ç –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö LLM. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö —Å –æ—Ü–µ–Ω–∫–æ–π –≤–ª–∏—è–Ω–∏—è –Ω–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏.

## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

> üìπ –í–∏–¥–µ–æ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ (—Ñ–æ—Ä–º–∞—Ç: –í–∏–¥–µ–æ + –ö–æ–¥).

**–°—Ü–µ–Ω–∞—Ä–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:**
1. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ UI
2. –ó–∞–¥–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
3. –ö–ª–∏–∫ –Ω–∞ —Å—Å—ã–ª–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞
4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö
5. –ê–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫: –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—Ç–æ–≤ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏, —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ç–∞—Ç, –ø—Ä–æ—Ü–µ–Ω—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö —Ü–∏—Ç–∞—Ç
6. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ –±–µ–∑ —Ü–∏—Ç–∞—Ç (–æ—Ü–µ–Ω–∫–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π)

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã:
- –ö–æ–ø–∏—Ä—É–µ–º RAG-—Å–∏—Å—Ç–µ–º—É –∏–∑ —É—Ä–æ–∫–∞ 17 (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥)
- –î–æ–±–∞–≤–ª—è–µ–º **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã** –≤ –ø—Ä–æ–º–ø—Ç –¥–ª—è LLM
- –†–µ–∞–ª–∏–∑—É–µ–º **–ø–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç** –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤ LLM
- –î–æ–±–∞–≤–ª—è–µ–º **–≤–∞–ª–∏–¥–∞—Ü–∏—é —Ü–∏—Ç–∞—Ç** (–ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å—Å—ã–ª–∫–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)
- –°–æ–∑–¥–∞—ë–º **API –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** –ø–æ —Å—Å—ã–ª–∫–∞–º
- –û–±–Ω–æ–≤–ª—è–µ–º **UI** –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–∏—Ç–∞—Ç –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –†–µ–∞–ª–∏–∑—É–µ–º **—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö** —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π

## üéØ –ü–∞–π–ø–ª–∞–π–Ω

```
–í–æ–ø—Ä–æ—Å
  ‚Üì
Embedding —á–µ—Ä–µ–∑ Ollama (nomic-embed-text)
  ‚Üì
–ü–æ–∏—Å–∫ top-K —á–∞–Ω–∫–æ–≤ (KnowledgeBaseSearchService)
  ‚Üì
–§–∏–ª—å—Ç—Ä/—Ä–µ—Ä–∞–Ω–∫–µ—Ä (–∏–∑ —É—Ä–æ–∫–∞ 17)
  ‚Üì
PromptBuilder —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º —Ü–∏—Ç–∞—Ç ‚Üí –∫–æ–Ω—Ç–µ–∫—Å—Ç
  ‚Üì
–ó–∞–ø—Ä–æ—Å –∫ OpenRouter (LLMService)
  ‚Üì
–ü–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞ (CitationParser)
  ‚Üì
–í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
  ‚Üì
–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
  ‚Üì
–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –∫–ª–∏–∫—É
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
lesson-18-rag-citations/
‚îú‚îÄ‚îÄ config/server.yaml
‚îú‚îÄ‚îÄ data/knowledge_base.db
‚îú‚îÄ‚îÄ documents/              # –î–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/
‚îÇ       ‚îú‚îÄ‚îÄ data/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OllamaClient.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OpenAIClient.kt
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ repository/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ AIRepository.kt
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ KnowledgeBaseRepository.kt
‚îÇ       ‚îú‚îÄ‚îÄ domain/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ agent/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ indexing/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DocumentIndexer.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmbeddingService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KnowledgeBaseSearchService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LLMService.kt
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PromptBuilder.kt          # –æ–±–Ω–æ–≤–ª—ë–Ω: —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ü–∏—Ç–∞—Ç
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RAGService.kt             # –æ–±–Ω–æ–≤–ª—ë–Ω: –ø–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CitationParser.kt        # –Ω–æ–≤—ã–π: –ø–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CitationAnalyzer.kt      # –Ω–æ–≤—ã–π: –∞–Ω–∞–ª–∏–∑ —Ü–∏—Ç–∞—Ç
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RelevanceFilter.kt       # –∏–∑ —É—Ä–æ–∫–∞ 17
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RerankerService.kt       # –∏–∑ —É—Ä–æ–∫–∞ 17
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ model/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ Citation.kt              # –Ω–æ–≤—ã–π: –º–æ–¥–µ–ª—å —Ü–∏—Ç–∞—Ç—ã
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ AnswerWithCitations.kt   # –Ω–æ–≤—ã–π: –æ—Ç–≤–µ—Ç —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ CitationTestResult.kt    # –Ω–æ–≤—ã–π: —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ RAGRequest.kt
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ RAGResponse.kt           # –æ–±–Ω–æ–≤–ª—ë–Ω: –¥–æ–±–∞–≤–ª–µ–Ω—ã citations
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ RetrievedChunk.kt
‚îÇ       ‚îî‚îÄ‚îÄ presentation/
‚îÇ           ‚îú‚îÄ‚îÄ controller/
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ ClientController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ IndexingController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ SearchController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ LLMController.kt
‚îÇ           ‚îÇ   ‚îú‚îÄ‚îÄ RAGController.kt         # –æ–±–Ω–æ–≤–ª—ë–Ω: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ü–∏—Ç–∞—Ç
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ DocumentController.kt    # –Ω–æ–≤—ã–π: –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚îÇ           ‚îî‚îÄ‚îÄ dto/
‚îÇ               ‚îú‚îÄ‚îÄ DocumentDtos.kt
‚îÇ               ‚îú‚îÄ‚îÄ ErrorResponse.kt
‚îÇ               ‚îú‚îÄ‚îÄ RAGDtos.kt               # –æ–±–Ω–æ–≤–ª—ë–Ω: –¥–æ–±–∞–≤–ª–µ–Ω—ã citations
‚îÇ               ‚îî‚îÄ‚îÄ CitationDtos.kt          # –Ω–æ–≤—ã–π: DTO –¥–ª—è —Ü–∏—Ç–∞—Ç
‚îî‚îÄ‚îÄ client/                # –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (Vanilla JS)
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ indexing.html
    ‚îú‚îÄ‚îÄ indexing.js
    ‚îú‚îÄ‚îÄ search.html
    ‚îú‚îÄ‚îÄ search.js
    ‚îú‚îÄ‚îÄ rag-compare.html   # –æ–±–Ω–æ–≤–ª—ë–Ω: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç
    ‚îú‚îÄ‚îÄ rag-compare.js     # –æ–±–Ω–æ–≤–ª—ë–Ω: –ø–∞—Ä—Å–∏–Ω–≥ –∏ –∫–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º
    ‚îú‚îÄ‚îÄ document-viewer.html  # –Ω–æ–≤—ã–π: –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞
    ‚îú‚îÄ‚îÄ document-viewer.js    # –Ω–æ–≤—ã–π: –∑–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    ‚îú‚îÄ‚îÄ citation-test.html    # –Ω–æ–≤—ã–π: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö
    ‚îú‚îÄ‚îÄ citation-test.js      # –Ω–æ–≤—ã–π: –ª–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îú‚îÄ‚îÄ citations.js          # –Ω–æ–≤—ã–π: —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
    ‚îú‚îÄ‚îÄ style.css
    ‚îî‚îÄ‚îÄ app.js
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:**
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
   - SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ `documents` –∏ `document_chunks`

2. **Ollama:**
   - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω Ollama
   - –ú–æ–¥–µ–ª—å `nomic-embed-text` –¥–æ—Å—Ç—É–ø–Ω–∞

3. **OpenRouter:**
   - API –∫–ª—é—á –≤ `.env` –∫–∞–∫ `OPENAI_API_KEY`
   - –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤ `config/server.yaml`

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —É—Ä–æ–∫–∞
cd lesson-18-rag-citations

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp config/server.yaml.example config/server.yaml
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å config/server.yaml

# –°–æ–∑–¥–∞—Ç—å .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)
echo "OPENAI_API_KEY=your_key_here" >> ../../.env

# –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
cd server
./gradlew build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
./gradlew run
```

### –ó–∞–ø—É—Å–∫

```bash
# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:8080
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- **–ì–ª–∞–≤–Ω–∞—è:** http://localhost:8080/
- **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:** http://localhost:8080/indexing.html
- **–ü–æ–∏—Å–∫:** http://localhost:8080/search.html
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ RAG:** http://localhost:8080/rag-compare.html
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞:** http://localhost:8080/document-viewer.html?path=documents/...
- **–¢–µ—Å—Ç —Ü–∏—Ç–∞—Ç:** http://localhost:8080/citation-test.html

## üì° API

### –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- `POST /api/indexing/index` ‚Äî –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- `GET /api/indexing/documents` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /api/search/query` ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π

### RAG-–∑–∞–ø—Ä–æ—Å—ã

#### 1. RAG-–∑–∞–ø—Ä–æ—Å —Å —Ü–∏—Ç–∞—Ç–∞–º–∏

**POST** `/api/rag/query`

**Request:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "topK": 5,
  "minSimilarity": 0.4,
  "applyFilter": true,
  "strategy": "hybrid"
}
```

**Response:**
```json
{
  "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
  "answer": "–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK [–ò—Å—Ç–æ—á–Ω–∏–∫: –°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞](documents/01-mcp-server-creation.md).",
  "citations": [
    {
      "text": "[–ò—Å—Ç–æ—á–Ω–∏–∫: –°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞](documents/01-mcp-server-creation.md)",
      "documentPath": "documents/01-mcp-server-creation.md",
      "documentTitle": "–°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞",
      "chunkId": "...",
      "position": {
        "start": 45,
        "end": 120
      }
    }
  ],
  "contextChunks": [...],
  "tokensUsed": 1350,
  "filterStats": {...},
  "rerankInsights": [...]
}
```

#### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞

**GET** `/api/documents/{documentPath}`

**Response:**
```json
{
  "documentPath": "documents/01-mcp-server-creation.md",
  "documentTitle": "–°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞",
  "content": "# –°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞\n\n...",
  "indexedAt": "2024-01-15T10:30:00Z",
  "chunksCount": 12
}
```

#### 3. –¢–µ—Å—Ç —Ü–∏—Ç–∞—Ç –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö

**POST** `/api/rag/test-citations`

**Request:**
```json
{
  "questions": [
    "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ?",
    "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥?",
    "–ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ Ollama?",
    "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤?"
  ],
  "topK": 5,
  "minSimilarity": 0.4,
  "applyFilter": true,
  "strategy": "hybrid"
}
```

**Response:**
```json
{
  "results": [
    {
      "question": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
      "hasCitations": true,
      "citationsCount": 2,
      "validCitationsCount": 2,
      "answer": "...",
      "citations": [...]
    },
    ...
  ],
  "metrics": {
    "totalQuestions": 5,
    "questionsWithCitations": 5,
    "averageCitationsPerAnswer": 2.4,
    "validCitationsPercentage": 100.0,
    "answersWithoutHallucinations": 4
  }
}
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config/server.yaml

```yaml
server:
  port: 8080
  host: "0.0.0.0"

ollama:
  baseUrl: "http://localhost:11434"
  model: "nomic-embed-text"
  timeout: 120000

knowledgeBase:
  databasePath: "data/knowledge_base.db"

indexing:
  chunkSize: 400
  overlapSize: 50
  documentsPath: "documents"

ai:
  provider: "openrouter"
  apiKey: "${OPENAI_API_KEY}"
  model: "gpt-4o-mini"
  temperature: 0.7
  maxTokens: 2000

rag:
  retrieval:
    topK: 5
    minSimilarity: 0.4
  filter:
    enabled: true
    type: "hybrid"
    threshold:
      minSimilarity: 0.6
      keepTop: 3
    reranker:
      model: "gpt-4o-mini"
      maxChunks: 6
      systemPrompt: "–¢—ã ‚Äî reranker. –û—Ü–µ–Ω–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å—É."
  citations:
    required: true                    # –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã
    format: "markdown"                # markdown | numbered | simple
    validate: true                    # –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç
    showInResponse: true              # –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã –≤ –æ—Ç–≤–µ—Ç–µ
```

### .env (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)

```bash
OPENAI_API_KEY=your_openrouter_api_key
```

## üí° –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/rag-compare.html`
2. –í–≤–µ—Å—Ç–∏ –≤–æ–ø—Ä–æ—Å: "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?"
3. –ù–∞–∂–∞—Ç—å "–°—Ä–∞–≤–Ω–∏—Ç—å"
4. –í –æ—Ç–≤–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏: `[–ò—Å—Ç–æ—á–Ω–∏–∫: –°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞](documents/01-mcp-server-creation.md)`
5. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Å—Å—ã–ª–∫—É
6. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞

### 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞

**–®–∞–≥–∏:**
1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Å—Å—ã–ª–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ
2. –û—Ç–∫—Ä–æ–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞
3. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
4. –ù–∞–∂–∞—Ç—å "–ó–∞–∫—Ä—ã—Ç—å" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –æ—Ç–≤–µ—Ç—É

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `/citation-test.html`
2. –í–≤–µ—Å—Ç–∏ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ)
3. –ù–∞–∂–∞—Ç—å "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç"
4. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
5. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏:
   - –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—Ç–æ–≤ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
   - –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ç–∞—Ç –Ω–∞ –æ—Ç–≤–µ—Ç
   - –ü—Ä–æ—Ü–µ–Ω—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö —Ü–∏—Ç–∞—Ç
   - –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—Ç–æ–≤ –±–µ–∑ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π

### 4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏ –±–µ–∑

**–®–∞–≥–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ü–∏—Ç–∞—Ç–∞–º–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ —Ç–µ—Ö –∂–µ –≤–æ–ø—Ä–æ—Å–∞—Ö –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–∏—Ç–∞—Ç (–≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
3. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π
   - –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
   - –ù–∞–ª–∏—á–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?" ‚Äî –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏ –∏ —É–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏
2. "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ?" ‚Äî –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥?" ‚Äî –¥–æ–ª–∂–µ–Ω —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
4. "–ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–µ—Ä–µ–∑ Ollama?" ‚Äî –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏
5. "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤?" ‚Äî –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—Ç–æ–≤ —Å —Ü–∏—Ç–∞—Ç–∞–º–∏:** > 90%
- **–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ç–∞—Ç –Ω–∞ –æ—Ç–≤–µ—Ç:** > 2
- **–ü—Ä–æ—Ü–µ–Ω—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö —Ü–∏—Ç–∞—Ç:** > 95%
- **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–≤–µ—Ç–æ–≤ –±–µ–∑ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π:** > 80%

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/citation-test.html` –º–æ–∂–Ω–æ:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ü–∏—Ç–∞—Ç (–∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Å—Å—ã–ª–∫–∏)

## üéì –¶–µ–ª–∏ —É—Ä–æ–∫–∞

- –ù–∞—É—á–∏—Ç—å—Å—è —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ—Ç LLM –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ü–∏—Ç–∞—Ç –∏–∑ –æ—Ç–≤–µ—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–∞—Ö
- –û—Ü–µ–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–∏—Ç–∞—Ç –Ω–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏
- –ü–æ–ª—É—á–∏—Ç—å RAG-—Å–∏—Å—Ç–µ–º—É —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–í–∏–¥–µ–æ + –ö–æ–¥)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

- [lesson-17-rag-reranking](../lesson-17-rag-reranking/) ‚Äî —Ä–µ—Ä–∞–Ω–∫–∏–Ω–≥ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- [lesson-16-rag-query](../lesson-16-rag-query/) ‚Äî –ø–µ—Ä–≤—ã–π RAG-–∑–∞–ø—Ä–æ—Å
- [lesson-15-document-indexing](../lesson-15-document-indexing/) ‚Äî –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [RAG: Retrieval-Augmented Generation](https://arxiv.org/abs/2005.11401) ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è –æ RAG
- [Hallucinations in RAG Systems](https://www.pinecone.io/learn/hallucinations-in-rag/) ‚Äî –ø—Ä–æ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –≤ RAG
- [Citation Extraction from LLM Responses](https://arxiv.org/abs/2305.14627) ‚Äî –ø—Ä–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç
- [Evaluating RAG Systems](https://www.pinecone.io/learn/evaluating-rag/) ‚Äî –ø—Ä–æ –æ—Ü–µ–Ω–∫—É –∫–∞—á–µ—Å—Ç–≤–∞ RAG
- [THEORY.md](./THEORY.md) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è —Ç–µ–æ—Ä–∏—è –ø–æ —Ü–∏—Ç–∞—Ç–∞–º –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –≤ RAG

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã —É—Ä–æ–∫–∞

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã —Å–Ω–∏–∂–∞—é—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏:** LLM –≤—ã–Ω—É–∂–¥–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
2. **–ü–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã:** –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Å—ã–ª–∫–∏
3. **UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:** –ø–æ–≤—ã—à–∞–µ—Ç –¥–æ–≤–µ—Ä–∏–µ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
4. **–ú–µ—Ç—Ä–∏–∫–∏ –≤–∞–∂–Ω—ã:** –ø–æ–º–æ–≥–∞—é—Ç –æ—Ü–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–¥—Ö–æ–¥–∞
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö

