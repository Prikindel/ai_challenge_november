name: Code Review

# –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≠—Ç–æ—Ç workflow —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º –¥–ª—è –∑–∞–ø—É—Å–∫–∞.
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UI –¥–ª—è —Ä–µ–≤—å—é –∫–æ–¥–∞ –≤–º–µ—Å—Ç–æ GitHub Action.
# –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
# 1. –î–æ–±–∞–≤–∏—Ç—å OPENAI_API_KEY –≤ secrets
# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ CI/CD –æ–∫—Ä—É–∂–µ–Ω–∏–∏
# 3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

on:
  pull_request:
    types: [opened, synchronize, reopened]
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  code-review:
    runs-on: ubuntu-latest
    if: false  # –û—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤–∫–ª—é—á–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏–≤ if: true
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è diff
      
      - name: Get diff
        id: get-diff
        run: |
          git diff ${{ github.event.pull_request.base.sha }}..${{ github.event.pull_request.head.sha }} > diff.txt
          echo "Diff saved to diff.txt"
      
      - name: Get changed files
        id: get-changed-files
        run: |
          git diff --name-only ${{ github.event.pull_request.base.sha }}..${{ github.event.pull_request.head.sha }} > changed-files.txt
          echo "Changed files saved to changed-files.txt"
      
      - name: Upload diff and changed files
        uses: actions/upload-artifact@v4
        with:
          name: pr-diff
          path: |
            diff.txt
            changed-files.txt
      
      - name: Comment PR
        uses: actions/github-script@v7
        with:
          script: |
            // –ü—Ä–æ—Å—Ç–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ diff
            const fs = require('fs');
            const diff = fs.readFileSync('diff.txt', 'utf8');
            const changedFiles = fs.readFileSync('changed-files.txt', 'utf8').split('\n').filter(f => f);
            
            let comment = `## ü§ñ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ PR –¥–ª—è —Ä–µ–≤—å—é –∫–æ–¥–∞\n\n`;
            comment += `**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** ${changedFiles.length}\n\n`;
            comment += `**–§–∞–π–ª—ã:**\n`;
            changedFiles.forEach(file => {
              comment += `- \`${file}\`\n`;
            });
            comment += `\n\n`;
            comment += `üí° –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–≤—å—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ UI: http://localhost:8080/code-review.html\n`;
            comment += `–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ diff —Ñ–∞–π–ª —á–µ—Ä–µ–∑ UI –¥–ª—è —Ä–µ–≤—å—é.\n`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

