# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: üî• –î–µ–Ω—å 19. –ú–∏–Ω–∏-—á–∞—Ç —Å –ø–∞–º—è—Ç—å—é –Ω–∞ RAG

–¢—ã ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–æ–∑–¥–∞—é—â–∏–π —É—Ä–æ–∫ ¬´üî• –î–µ–Ω—å 19. –ú–∏–Ω–∏-—á–∞—Ç —Å –ø–∞–º—è—Ç—å—é –Ω–∞ RAG¬ª –≤ –º–æ–¥—É–ª–µ `lesson-19-rag-chat`. –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–µ–∫ **Kotlin + Ktor + Clean Architecture + SQLite** —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –Ω–∞ **vanilla JS**. –í –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑—ã –º—ã **–∫–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥ –∏–∑ —É—Ä–æ–∫–∞ 18** –∏ —Ä–∞–∑–≤–∏–≤–∞–µ–º –µ–≥–æ ‚Äî –º–µ–Ω—è–µ–º –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `lesson-18-rag-citations` –Ω–∞ `lesson-19-rag-chat`, –Ω–µ –ª–æ–º–∞—è —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.

## üéØ –¶–µ–ª—å —É—Ä–æ–∫–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —á–∞—Ç-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- **–•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞** (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–≤–µ—Ç—ã –±–æ—Ç–∞)
- **–ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –≤–æ–ø—Ä–æ—Å–µ –∏—â–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –±–∞–∑–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** —á–µ—Ä–µ–∑ RAG
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å —É—á—ë—Ç–æ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏** –∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–≤–æ–¥–∏—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏**, –æ—Ç–∫—É–¥–∞ –±—ã–ª –≤–∑—è—Ç –æ—Ç–≤–µ—Ç (–∏–∑ —É—Ä–æ–∫–∞ 18)

### –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è

```
–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ + –ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å ‚Üí RAG-–ø–æ–∏—Å–∫ ‚Üí –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π ‚Üí –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π ‚Üí –ó–∞–ø—Ä–æ—Å –∫ LLM ‚Üí –û—Ç–≤–µ—Ç —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
```

–ß–∞—Ç-–±–æ—Ç –¥–æ–ª–∂–µ–Ω:
- –ü–æ–º–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–∏–∞–ª–æ–≥–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RAG –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ
- –û—Ç–≤–µ—á–∞—Ç—å —Å —É—á—ë—Ç–æ–º –∫–∞–∫ –∏—Å—Ç–æ—Ä–∏–∏, —Ç–∞–∫ –∏ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

---

## üìã –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã)

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–π —à–∞–≥ = –æ—Ç–¥–µ–ª—å–Ω—ã–π git-–∫–æ–º–º–∏—Ç.
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ **–°–¢–û–ü**, –ø–æ–∫–∞–∂–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –¥–æ–∂–¥–∏—Å—å ¬´–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–π¬ª.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –¥–µ–ª–∞–µ—Ç merge/commit –¥–∞–ª–µ–µ.

### –ö–æ–º–º–∏—Ç 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞ 18

**–ó–∞–¥–∞—á–∞:** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `lesson-18-rag-citations/` –≤ `lesson-19-rag-chat/`.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã (server, client, config, README, THEORY, PROMPT, CHAT_PROMPT, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –¥–∞–Ω–Ω—ã–µ).
2. –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è:
   - –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞, Gradle settings, package references, –∑–∞–≥–æ–ª–æ–≤–∫–∏, README
   - –í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `lesson-18-rag-citations` ‚Üí `lesson-19-rag-chat`
   - ¬´–î–µ–Ω—å 18¬ª ‚Üí ¬´–î–µ–Ω—å 19¬ª
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è, –ø–æ–∫–∞–∑–∞—Ç—å diff –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

### –ö–æ–º–º–∏—Ç 2: –ú–æ–¥–µ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

**–ó–∞–¥–∞—á–∞:** —Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. –ú–æ–¥–µ–ª—å `ChatMessage`:
   ```kotlin
   data class ChatMessage(
       val id: String,
       val sessionId: String,        // ID —Å–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–∞
       val role: MessageRole,        // USER –∏–ª–∏ ASSISTANT
       val content: String,          // —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
       val citations: List<Citation>? = null,  // –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –±–æ—Ç–∞)
       val timestamp: Long,          // –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
       val metadata: Map<String, String>? = null  // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
   )
   
   enum class MessageRole {
       USER,
       ASSISTANT
   }
   ```

2. –ú–æ–¥–µ–ª—å `ChatSession`:
   ```kotlin
   data class ChatSession(
       val id: String,
       val createdAt: Long,
       val updatedAt: Long,
       val messageCount: Int,
       val title: String? = null  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
   )
   ```

3. `ChatRepository` (data/repository):
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ SQLite
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ –ø–æ sessionId
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
   - –ú–µ—Ç–æ–¥—ã: `saveMessage()`, `getHistory()`, `createSession()`, `getSession()`

4. –°—Ö–µ–º–∞ –ë–î:
   ```sql
   CREATE TABLE chat_sessions (
       id TEXT PRIMARY KEY,
       created_at INTEGER NOT NULL,
       updated_at INTEGER NOT NULL,
       message_count INTEGER NOT NULL,
       title TEXT
   );
   
   CREATE TABLE chat_messages (
       id TEXT PRIMARY KEY,
       session_id TEXT NOT NULL,
       role TEXT NOT NULL,
       content TEXT NOT NULL,
       citations TEXT,  -- JSON –º–∞—Å—Å–∏–≤ —Ü–∏—Ç–∞—Ç
       timestamp INTEGER NOT NULL,
       metadata TEXT,   -- JSON –æ–±—ä–µ–∫—Ç
       FOREIGN KEY (session_id) REFERENCES chat_sessions(id)
   );
   
   CREATE INDEX idx_chat_messages_session ON chat_messages(session_id);
   CREATE INDEX idx_chat_messages_timestamp ON chat_messages(timestamp);
   ```

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQLite (–∫–∞–∫ –≤ —É—Ä–æ–∫–µ 15-18)
- –•—Ä–∞–Ω–∏—Ç—å —Ü–∏—Ç–∞—Ç—ã –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ sessionId –∏ timestamp –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

### –ö–æ–º–º–∏—Ç 3: ChatService ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RAG —Å –∏—Å—Ç–æ—Ä–∏–µ–π

**–ó–∞–¥–∞—á–∞:** —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç RAG-–ø–æ–∏—Å–∫ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `ChatService` (domain/service):
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∏ sessionId
   - –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –∏–∑ `ChatRepository`
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç RAG-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ `RAGService` (–∏–∑ —É—Ä–æ–∫–∞ 18)
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ LLM —á–µ—Ä–µ–∑ `LLMService`
   - –ü–∞—Ä—Å–∏—Ç —Ü–∏—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ `CitationParser` (–∏–∑ —É—Ä–æ–∫–∞ 18)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å —Ü–∏—Ç–∞—Ç–∞–º–∏

2. –ú–µ—Ç–æ–¥ `processMessage()`:
   ```kotlin
   suspend fun processMessage(
       sessionId: String,
       userMessage: String
   ): ChatResponse {
       // 1. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
       val history = chatRepository.getHistory(sessionId)
       
       // 2. RAG-–ø–æ–∏—Å–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
       val ragResult = ragService.queryWithRAG(
           question = userMessage,
           topK = 5,
           minSimilarity = 0.4
       )
       
       // 3. –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
       val prompt = promptBuilder.buildChatPrompt(
           history = history,
           currentQuestion = userMessage,
           contextChunks = ragResult.contextChunks
       )
       
       // 4. –ó–∞–ø—Ä–æ—Å –∫ LLM
       val llmResponse = llmService.getCompletion(prompt)
       
       // 5. –ü–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç
       val citations = citationParser.parseCitations(
           answer = llmResponse.content,
           availableDocuments = ragResult.contextChunks.map { it.documentPath }
       )
       
       // 6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é
       chatRepository.saveMessage(
           ChatMessage(
               id = generateId(),
               sessionId = sessionId,
               role = MessageRole.USER,
               content = userMessage,
               timestamp = System.currentTimeMillis()
           )
       )
       
       chatRepository.saveMessage(
           ChatMessage(
               id = generateId(),
               sessionId = sessionId,
               role = MessageRole.ASSISTANT,
               content = llmResponse.content,
               citations = citations,
               timestamp = System.currentTimeMillis()
           )
       )
       
       // 7. –í–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç
       return ChatResponse(
           message = llmResponse.content,
           citations = citations,
           sessionId = sessionId
       )
   }
   ```

3. –û–±–Ω–æ–≤–∏—Ç—å `PromptBuilder`:
   - –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `buildChatPrompt()` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π
   - –í–∫–ª—é—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –≤ –ø—Ä–æ–º–ø—Ç
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–∏—Ç–∞—Ç (–∏–∑ —É—Ä–æ–∫–∞ 18)

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `RAGService` –∏–∑ —É—Ä–æ–∫–∞ 18
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `CitationParser` –∏–∑ —É—Ä–æ–∫–∞ 18
- –ù–µ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å RAG-–∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

### –ö–æ–º–º–∏—Ç 4: API –¥–ª—è —á–∞—Ç–∞

**–ó–∞–¥–∞—á–∞:** —Å–æ–∑–¥–∞—Ç—å HTTP API endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–æ–º.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `ChatController` (presentation/controller):
   - `POST /api/chat/sessions` ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
   - `POST /api/chat/sessions/{sessionId}/messages` ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
   - `GET /api/chat/sessions/{sessionId}/messages` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
   - `GET /api/chat/sessions` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
   - `DELETE /api/chat/sessions/{sessionId}` ‚Äî —É–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é

2. DTO:
   ```kotlin
   data class CreateSessionRequest(
       val title: String? = null
   )
   
   data class CreateSessionResponse(
       val sessionId: String,
       val createdAt: Long
   )
   
   data class SendMessageRequest(
       val message: String
   )
   
   data class SendMessageResponse(
       val message: String,
       val citations: List<CitationDto>,
       val sessionId: String,
       val messageId: String
   )
   
   data class ChatHistoryResponse(
       val sessionId: String,
       val messages: List<ChatMessageDto>
   )
   ```

3. –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:

   **–°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é:**
   ```http
   POST /api/chat/sessions
   Content-Type: application/json
   
   {
     "title": "–û–±—Å—É–∂–¥–µ–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–æ–≤"
   }
   
   Response:
   {
     "sessionId": "session-123",
     "createdAt": 1705320600
   }
   ```

   **–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   ```http
   POST /api/chat/sessions/session-123/messages
   Content-Type: application/json
   
   {
     "message": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?"
   }
   
   Response:
   {
     "message": "–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ...",
     "citations": [
       {
         "text": "[–ò—Å—Ç–æ—á–Ω–∏–∫: –°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞](documents/01-mcp-server-creation.md)",
         "documentPath": "documents/01-mcp-server-creation.md",
         "documentTitle": "–°–æ–∑–¥–∞–Ω–∏–µ MCP —Å–µ—Ä–≤–µ—Ä–∞"
       }
     ],
     "sessionId": "session-123",
     "messageId": "msg-456"
   }
   ```

   **–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é:**
   ```http
   GET /api/chat/sessions/session-123/messages
   
   Response:
   {
     "sessionId": "session-123",
     "messages": [
       {
         "id": "msg-123",
         "role": "USER",
         "content": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?",
         "timestamp": 1705320600
       },
       {
         "id": "msg-456",
         "role": "ASSISTANT",
         "content": "–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ...",
         "citations": [...],
         "timestamp": 1705320610
       }
     ]
   }
   ```

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

### –ö–æ–º–º–∏—Ç 5: UI –¥–ª—è —á–∞—Ç–∞ (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

**–ó–∞–¥–∞—á–∞:** —Å–æ–∑–¥–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —á–∞—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ü–∏—Ç–∞—Ç.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `chat.html`:
   - –û–±–ª–∞—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–∞—è)
   - –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç –≤ –æ—Ç–≤–µ—Ç–∞—Ö (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏)
   - –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

2. `chat.js`:
   - –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
   - –ü–∞—Ä—Å–∏–Ω–≥ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API endpoints
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

3. –°—Ç–∏–ª–∏ (`style.css`):
   - –°—Ç–∏–ª–∏ –¥–ª—è —á–∞—Ç–∞ (–ø—É–∑—ã—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ü–∏—Ç–∞—Ç
   - –ê–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ/–ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ UI:
   ```
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  –ß–∞—Ç —Å RAG-–ø–∞–º—è—Ç—å—é              ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ  [–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π]            ‚îÇ
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
   ‚îÇ  ‚îÇ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –í–æ–ø—Ä–æ—Å?    ‚îÇ   ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
   ‚îÇ  ‚îÇ –ë–æ—Ç: –û—Ç–≤–µ—Ç...           ‚îÇ   ‚îÇ
   ‚îÇ  ‚îÇ [–ò—Å—Ç–æ—á–Ω–∏–∫: ...](...)    ‚îÇ   ‚îÇ
   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ  [–ü–æ–ª–µ –≤–≤–æ–¥–∞] [–û—Ç–ø—Ä–∞–≤–∏—Ç—å]      ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```

5. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–æ—Ç–∫—Ä—ã–≤–∞—é—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –∫–∞–∫ –≤ —É—Ä–æ–∫–µ 18)
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ —É—Ä–æ–∫–∞ 18
- –ù–µ —É–¥–∞–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, –ø–æ–∏—Å–∫, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ RAG)

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

### –ö–æ–º–º–∏—Ç 6: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ –≤ UI

**–ó–∞–¥–∞—á–∞:** –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. –û–±–Ω–æ–≤–∏—Ç—å `chat.html`:
   - –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–æ —Å–ø–∏—Å–∫–æ–º —Å–µ—Å—Å–∏–π
   - –ö–Ω–æ–ø–∫–∞ "–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è"
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

2. –û–±–Ω–æ–≤–∏—Ç—å `chat.js`:
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å–µ—Å—Å–∏–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ –≤ localStorage

3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ UI:
   ```
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ –°–µ—Å—Å–∏–∏   ‚îÇ  –ß–∞—Ç                 ‚îÇ
   ‚îÇ          ‚îÇ                      ‚îÇ
   ‚îÇ [+ –ù–æ–≤.] ‚îÇ  [–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π] ‚îÇ
   ‚îÇ          ‚îÇ                      ‚îÇ
   ‚îÇ –°–µ—Å—Å–∏—è 1 ‚îÇ  [–ü–æ–ª–µ –≤–≤–æ–¥–∞]        ‚îÇ
   ‚îÇ –°–µ—Å—Å–∏—è 2 ‚îÇ                      ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

### –ö–æ–º–º–∏—Ç 7: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π

**–ó–∞–¥–∞—á–∞:** –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ª–∏–º–∏—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `ChatPromptBuilder` (domain/service):
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –Ω–µ–¥–∞–≤–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

2. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏:
   - **Sliding window**: –±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–æ–æ–±—â–µ–Ω–∏–π
   - **Token limit**: –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ —Ç–æ–∫–µ–Ω–∞–º
   - **Summary**: —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `config/server.yaml`:
   ```yaml
   chat:
     history:
       maxMessages: 10        # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
       maxTokens: 2000        # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
       summarizeOld: false    # —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   ```

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

---

### –ö–æ–º–º–∏—Ç 8: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –≤—ã–≤–æ–¥—ã

**–ó–∞–¥–∞—á–∞:** –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É—Ä–æ–∫ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤—ã–≤–æ–¥—ã.

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û–±–Ω–æ–≤–∏—Ç—å `README.md`, `THEORY.md`, `PROMPT.md`, `CHAT_PROMPT.txt` –ø–æ–¥ –î–µ–Ω—å 19.
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª ¬´–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è¬ª —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ –≤–∏–¥–µ–æ (—Ñ–æ—Ä–º–∞—Ç: –í–∏–¥–µ–æ + –ö–æ–¥).
3. –û–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–∞—Ç —Å RAG-–ø–∞–º—è—Ç—å—é
   - –ö–∞–∫ –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Ç–≤–µ—Ç—ã
   - –ö–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —á–∞—Ç–∞
4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
5. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤–æ–π `README.md`, –¥–æ–±–∞–≤–∏–≤ —Å—Å—ã–ª–∫—É –Ω–∞ —É—Ä–æ–∫ 19.

**–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞:** –ø–æ–∫–∞–∑–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

## üß† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –•—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

**SQLite —Ç–∞–±–ª–∏—Ü—ã:**
- `chat_sessions` ‚Äî —Å–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤
- `chat_messages` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ—Å—Å–∏—è—Ö

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ö–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- –°–æ–æ–±—â–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω—ã —Å —Å–µ—Å—Å–∏–µ–π —á–µ—Ä–µ–∑ `session_id`
- –¶–∏—Ç–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Å–µ—Å—Å–∏–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RAG —Å –∏—Å—Ç–æ—Ä–∏–µ–π

**–ü–∞–π–ø–ª–∞–π–Ω:**
1. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å RAG-–ø–æ–∏—Å–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
3. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç: —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ + –∏—Å—Ç–æ—Ä–∏—è + –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ RAG + —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å
4. –ó–∞–ø—Ä–æ—Å –∫ LLM
5. –ü–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é

### –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞.

–í–ê–ñ–ù–û: –¢—ã –û–ë–Ø–ó–ê–ù —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –æ—Ç–≤–µ—Ç–∞.

–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞:
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]: –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?
[–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç]: –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK [–ò—Å—Ç–æ—á–Ω–∏–∫: ...](...)
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]: –ê –∫–∞–∫ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?

–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:
[–ß–∞–Ω–∫ 1] (–¥–æ–∫—É–º–µ–Ω—Ç: documents/01-mcp-server-creation.md)
...

–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å: –ê –∫–∞–∫ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?

–û—Ç–≤–µ—Ç (—Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏):
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–æ–π.

**–†–µ—à–µ–Ω–∏—è:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å–æ–æ–±—â–µ–Ω–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ N)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ç–æ–∫–µ–Ω–∞–º (–º–∞–∫—Å–∏–º—É–º X —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)
- –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã

**–ò–∑ —É—Ä–æ–∫–∞ 18:**
- LLM –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `[–ò—Å—Ç–æ—á–Ω–∏–∫: –Ω–∞–∑–≤–∞–Ω–∏–µ](–ø—É—Ç—å)`
- –ü–∞—Ä—Å–∏–Ω–≥ —Ü–∏—Ç–∞—Ç —á–µ—Ä–µ–∑ `CitationParser`
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–∏—Ç–∞—Ç
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –≤ UI —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

---

## üìä –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏:**
   ```
   POST /api/chat/sessions
   ‚Üí sessionId: "session-123"
   ```

2. **–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   ```
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä?"
   
   –°–∏—Å—Ç–µ–º–∞:
   - RAG-–ø–æ–∏—Å–∫ ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏, —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç)
   - –ó–∞–ø—Ä–æ—Å –∫ LLM
   - –û—Ç–≤–µ—Ç: "–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SDK [–ò—Å—Ç–æ—á–Ω–∏–∫: ...](...)"
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
   ```

3. **–í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   ```
   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ê –∫–∞–∫ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å?"
   
   –°–∏—Å—Ç–µ–º–∞:
   - –ü–æ–ª—É—á–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é: [–ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç]
   - RAG-–ø–æ–∏—Å–∫ ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —á–∞–Ω–∫–∏
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç (—Å –∏—Å—Ç–æ—Ä–∏–µ–π + –∫–æ–Ω—Ç–µ–∫—Å—Ç)
   - –ó–∞–ø—Ä–æ—Å –∫ LLM (LLM –ø–æ–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç "–µ–≥–æ" = SDK)
   - –û—Ç–≤–µ—Ç: "SDK –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ npm [–ò—Å—Ç–æ—á–Ω–∏–∫: ...](...)"
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
   ```

---

## üéì –¶–µ–ª–∏ —É—Ä–æ–∫–∞

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–∞—Ç-–±–æ—Ç —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RAG-–ø–æ–∏—Å–∫ –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã –∏–∑ —É—Ä–æ–∫–∞ 18
- –°–æ–∑–¥–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —á–∞—Ç–∞
- –ü–æ–ª—É—á–∏—Ç—å –º–∏–Ω–∏-—á–∞—Ç —Å RAG-–ø–∞–º—è—Ç—å—é –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–í–∏–¥–µ–æ + –ö–æ–¥)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `PROMPT.md` ‚Äî —Ç–µ–∫—É—â–µ–µ –¢–ó (—ç—Ç–æ—Ç —Ñ–∞–π–ª).
- `THEORY.md` ‚Äî —Ç–µ–æ—Ä–∏—è –ø—Ä–æ —á–∞—Ç-–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é –∏ RAG.
- `README.md` ‚Äî —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —É—Ä–æ–∫–∞.
- `CHAT_PROMPT.txt` ‚Äî –∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è –¢–ó –¥–ª—è –∞–≥–µ–Ω—Ç–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

