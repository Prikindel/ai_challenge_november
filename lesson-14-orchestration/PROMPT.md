# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: üî• –î–µ–Ω—å 14. Orchestration

–¢—ã ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–æ–∑–¥–∞—é—â–∏–π —É—Ä–æ–∫ ¬´üî• –î–µ–Ω—å 14. Orchestration¬ª –≤ –º–æ–¥—É–ª–µ `lesson-14-orchestration`. –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–µ–∫ **Kotlin + Ktor + Clean Architecture + SQLite** —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –Ω–∞ **vanilla JS**. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –¥—Ä—É–≥–∏—Ö —É—Ä–æ–∫–æ–≤ –≤ –∫–æ–¥–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Kotlin SDK –¥–ª—è MCP** (`io.modelcontextprotocol:kotlin-sdk`) –∏ **OpenRouter API** —Å function calling.

## üéØ –¶–µ–ª—å —É—Ä–æ–∫–∞

–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É **–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤**, –≥–¥–µ LLM —Å–∞–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –∑–∞–¥–∞—á. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º** –∏ –Ω–µ –∑–Ω–∞—Ç—å –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö ‚Äî –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π –≤ MCP —Å–µ—Ä–≤–µ—Ä–∞—Ö.

### –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:

**LLM –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏**, –≤—ã–±–∏—Ä–∞—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω ‚Äî –æ–Ω –Ω–µ –∑–Ω–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö, –∞ LLM —Å–∞–º–∞ –∏–∑—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π.

### –°—Ü–µ–Ω–∞—Ä–∏–π: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å"

–°–æ–∑–¥–∞—ë–º —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç:
1. **–°–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–≤–µ–±-—á–∞—Ç, Telegram, —Ñ–∞–π–ª—ã)
2. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ** (–∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
3. **–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç—ã** –∏ –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∏—Ö (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª, –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram)

### –ü—Ä–∏–º–µ—Ä–Ω—ã–π flow:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–µ—Ä–µ–ø–∏—Å–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π, –∏–∑–≤–ª–µ–∫–∏ –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã, 
                —Ä–∞—Å—Å—á–∏—Ç–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –æ—Ç—á—ë—Ç –≤ Telegram"

–ò—Ç–µ—Ä–∞—Ü–∏—è 1:
  LLM: "–ú–Ω–µ –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç get_chat_history(startTime, endTime) –∏–∑ Data Collection Server
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç get_telegram_messages(startTime, endTime) –∏–∑ Data Collection Server
  ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (groupId –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TELEGRAM_GROUP_ID)

–ò—Ç–µ—Ä–∞—Ü–∏—è 2:
  LLM: "–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ"
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç analyze_sentiment(text) –∏–∑ Data Processing Server
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç extract_keywords(text, count) –∏–∑ Data Processing Server
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç calculate_statistics(data) –∏–∑ Data Processing Server
  ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

–ò—Ç–µ—Ä–∞—Ü–∏—è 3:
  LLM: "–ù—É–∂–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ"
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç generate_report(title, content, format) –∏–∑ Reporting Server
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç send_telegram_message(message) –∏–∑ Reporting Server
  ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (userId –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TELEGRAM_CHAT_ID)

–ò—Ç–µ—Ä–∞—Ü–∏—è 4:
  LLM: "–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, —Å–æ–æ–±—â–∞—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"
  ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –ø–µ—Ä–µ–ø–∏—Å–∫—É –∑–∞ 7 –¥–Ω–µ–π, 
     –∏–∑–≤–ª—ë–∫ –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã, —Ä–∞—Å—Å—á–∏—Ç–∞–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á—ë—Ç –≤ –≤–∞—à Telegram"
```

---

## üìã –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã)

**–í–ê–ñ–ù–û:** –†–µ–∞–ª–∏–∑—É–π –ø–æ—à–∞–≥–æ–≤–æ, –∫–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π git –∫–æ–º–º–∏—Ç. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –ø–æ–∫–∞–∂–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –æ–Ω –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç –∏ —Å–∫–∞–∂–µ—Ç "–ø—Ä–∏—Å—Ç—É–ø–∞–π –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É".

### –ö–æ–º–º–∏—Ç 1: MCP Server - Data Collection (—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö)

–°–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
1. `get_chat_history(startTime, endTime)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–µ–±-—á–∞—Ç–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –ß–∏—Ç–∞–µ—Ç –∏–∑ –ë–î (SQLite, —Ç–∞–±–ª–∏—Ü–∞ `chat_messages` –∏–ª–∏ –∏–∑ lesson-09 `memory.db`)
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `startTime` (number, Unix timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö), `endTime` (number)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π `[{"role": "user|assistant", "content": "...", "timestamp": ...}]`

2. `get_telegram_messages(startTime, endTime)` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –ß–∏—Ç–∞–µ—Ç –∏–∑ –ë–î (SQLite, —Ç–∞–±–ª–∏—Ü–∞ `telegram_messages` –∏–∑ lesson-12)
   - ID –≥—Ä—É–ø–ø—ã –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `TELEGRAM_GROUP_ID`)
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `startTime` (number), `endTime` (number)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π `[{"id": "...", "content": "...", "author": "...", "timestamp": ...}]`
   - **–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π –ª–æ–≥–∏–∫—É –∏–∑ lesson-12 (TelegramMessageRepository, —Ç–∞–±–ª–∏—Ü–∞ telegram_messages)

3. `get_file_content(filePath)` ‚Äî –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
   - –ß–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `filePath` (string, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
data-collection-mcp-server/
‚îú‚îÄ‚îÄ build.gradle.kts
‚îú‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/
‚îÇ   ‚îú‚îÄ‚îÄ Main.kt
‚îÇ   ‚îú‚îÄ‚îÄ Config.kt
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatHistoryRepository.kt
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TelegramMessageRepository.kt  # –ò—Å–ø–æ–ª—å–∑—É–π –∏–∑ lesson-12 –∏–ª–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–π –ª–æ–≥–∏–∫—É
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FileRepository.kt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ model/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TelegramMessage.kt  # –ú–æ–¥–µ–ª—å –∏–∑ lesson-12
‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetChatHistoryHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetTelegramMessagesHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GetFileContentHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ToolRegistry.kt
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ MCPServer.kt
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ data-collection-mcp-server.yaml
```

**–í–∞–∂–Ω–æ - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å ToolHandler:**
- –í—Å–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ `ToolHandler<Input, Output>` (—Å–º. MCP_GUIDE.md)
- –ü—Ä–∏–º–µ—Ä:
```kotlin
abstract class ToolHandler<Input, Output> {
    protected abstract val logger: Logger
    
    open fun handle(params: Input): CallToolResult {
        return try {
            val result = execute(params)
            CallToolResult(
                content = listOf(prepareResult(params, result))
            )
        } catch (e: Exception) {
            logger.error("–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞: ${e.message}", e)
            CallToolResult(
                content = listOf(TextContent(text = "–û—à–∏–±–∫–∞: ${e.message}"))
            )
        }
    }
    
    protected abstract fun execute(params: Input): Output
    protected abstract fun prepareResult(request: Input, result: Output): TextContent
}
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config/data-collection-mcp-server.yaml`):**
```yaml
database:
  chatHistory:
    path: "../lesson-09-web-chat-memory/data/memory.db"  # –∏–ª–∏ —Å–≤–æ–π –ø—É—Ç—å
  telegramMessages:
    path: "../lesson-12-reminder-mcp/data/summary.db"  # –ë–î –∏–∑ lesson-12 (–∏–ª–∏ —Å–≤–æ–π –ø—É—Ç—å)
    
fileSystem:
  basePath: "."  # –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å –¥–ª—è —Ñ–∞–π–ª–æ–≤

telegram:
  groupId: "${TELEGRAM_GROUP_ID}"  # ID –≥—Ä—É–ø–ø—ã –∏–∑ .env
```

**–í–∞–∂–Ω–æ:**
- –í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å **–¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è** –≤ `description` –∏ `inputSchema`
- –û–ø–∏—Å–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã LLM –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –≤ `stderr` (—Å–º. MCP_GUIDE.md)

### –ö–æ–º–º–∏—Ç 2: MCP Server - Data Processing (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)

–°–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
1. `analyze_sentiment(text)` ‚Äî –∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `text` (string)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON `{"sentiment": "positive|negative|neutral", "score": 0.0-1.0, "explanation": "..."}`
   - –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ–¥—Å—á—ë—Ç –ø–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö/–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Å–ª–æ–≤ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞

2. `extract_keywords(text, count)` ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `text` (string), `count` (number, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON –º–∞—Å—Å–∏–≤ `["keyword1", "keyword2", ...]`
   - –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: TF-IDF –∏–ª–∏ —á–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑

3. `calculate_statistics(data)` ‚Äî —Ä–∞—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –¥–∞–Ω–Ω—ã–º
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `data` (string, JSON –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON `{"totalMessages": 100, "uniqueUsers": 5, "averageLength": 50, "timeRange": {...}}`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
data-processing-mcp-server/
‚îú‚îÄ‚îÄ build.gradle.kts
‚îú‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/
‚îÇ   ‚îú‚îÄ‚îÄ Main.kt
‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AnalyzeSentimentHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ExtractKeywordsHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CalculateStatisticsHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ToolRegistry.kt
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ MCPServer.kt
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ data-processing-mcp-server.yaml
```

**–í–∞–∂–Ω–æ - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å ToolHandler:**
- –í—Å–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ `ToolHandler<Input, Output>` (—Å–º. MCP_GUIDE.md)

**–í–∞–∂–Ω–æ:**
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏** ‚Äî –∏—Ö –æ–ø–∏—Å–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã –æ–±—ä—è—Å–Ω—è—Ç—å, —á—Ç–æ –æ–Ω–∏ –¥–µ–ª–∞—é—Ç
- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ ML)

### –ö–æ–º–º–∏—Ç 3: MCP Server - Reporting (–æ—Ç—á—ë—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫–∞)

–°–æ–∑–¥–∞—Ç—å MCP —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤ –∏ –∏—Ö –¥–æ—Å—Ç–∞–≤–∫–∏:

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
1. `generate_report(title, content, format)` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `title` (string), `content` (string, Markdown –∏–ª–∏ —Ç–µ–∫—Å—Ç), `format` (string, "markdown"|"text")
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON `{"report": "...", "format": "markdown", "length": 1000}`

2. `save_to_file(filePath, content)` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤ —Ñ–∞–π–ª
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `filePath` (string), `content` (string)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON `{"success": true, "filePath": "...", "size": 1000}`

3. `send_telegram_message(message)` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
   - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `TELEGRAM_CHAT_ID`)
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `message` (string)
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: JSON `{"success": true, "messageId": 123}` –∏–ª–∏ `{"success": false, "error": "..."}`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram Bot API

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
reporting-mcp-server/
‚îú‚îÄ‚îÄ build.gradle.kts
‚îú‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/
‚îÇ   ‚îú‚îÄ‚îÄ Main.kt
‚îÇ   ‚îú‚îÄ‚îÄ Config.kt
‚îÇ   ‚îú‚îÄ‚îÄ telegram/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TelegramBotService.kt
‚îÇ   ‚îú‚îÄ‚îÄ tools/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GenerateReportHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SaveToFileHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SendTelegramMessageHandler.kt  # –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler<Input, Output>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ToolRegistry.kt
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ MCPServer.kt
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ reporting-mcp-server.yaml
```

**–í–∞–∂–Ω–æ - –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å ToolHandler:**
- –í—Å–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ `ToolHandler<Input, Output>` (—Å–º. MCP_GUIDE.md)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
telegram:
  botToken: "${TELEGRAM_BOT_TOKEN}"  # –∏–∑ .env
  chatId: "${TELEGRAM_CHAT_ID}"  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑ .env
  
fileSystem:
  basePath: "reports"  # –ø–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤
```

### –ö–æ–º–º–∏—Ç 4: –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - MCP –∫–ª–∏–µ–Ω—Ç –∏ –º–µ–Ω–µ–¥–∂–µ—Ä

–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏:

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `MCPClientManager` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ MCP –∫–ª–∏–µ–Ω—Ç–∞–º–∏
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º MCP —Å–µ—Ä–≤–µ—Ä–∞–º (JAR —Ñ–∞–π–ª—ã)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ YAML
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
   - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

2. `MCPToolAgent` ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç LLM tools
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –≤—Å–µ—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç OpenAI/OpenRouter tools
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ —Å–µ—Ä–≤–µ—Ä–µ-–∏—Å—Ç–æ—á–Ω–∏–∫–µ (–¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏)

3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ (`config/mcp-servers.yaml`):
```yaml
mcp:
  servers:
    - id: "data-collection"
      name: "Data Collection MCP Server"
      jarPath: "mcp-servers/data-collection-mcp-server-1.0.0.jar"
      configPath: "config/data-collection-mcp-server.yaml"
      type: "local"  # local –∏–ª–∏ remote
      
    - id: "data-processing"
      name: "Data Processing MCP Server"
      jarPath: "mcp-servers/data-processing-mcp-server-1.0.0.jar"
      configPath: "config/data-processing-mcp-server.yaml"
      type: "local"
      
    - id: "reporting"
      name: "Reporting MCP Server"
      jarPath: "mcp-servers/reporting-mcp-server-1.0.0.jar"
      configPath: "config/reporting-mcp-server.yaml"
      type: "local"
      
    # –ü—Ä–∏–º–µ—Ä –≤–Ω–µ—à–Ω–µ–≥–æ MCP —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
    - id: "external-example"
      name: "External MCP Server Example"
      url: "https://example.com/mcp/sse"  # –¥–ª—è remote
      type: "remote"
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
server/
‚îú‚îÄ‚îÄ src/main/kotlin/com/prike/
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MCPClient.kt
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MCPClientManager.kt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ MCPServerConfig.kt
‚îÇ   ‚îî‚îÄ‚îÄ domain/
‚îÇ       ‚îî‚îÄ‚îÄ agent/
‚îÇ           ‚îî‚îÄ‚îÄ MCPToolAgent.kt
```

**API endpoints:**
- `GET /api/mcp/servers` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
- `GET /api/mcp/tools` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `GET /api/mcp/connections` ‚Äî —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### –ö–æ–º–º–∏—Ç 5: LLM –∞–≥–µ–Ω—Ç —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º

–°–æ–∑–¥–∞—Ç—å LLM –∞–≥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏:

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `OrchestrationAgent` ‚Äî –∞–≥–µ–Ω—Ç –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–Ω–µ –∑–Ω–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏–∑ `MCPToolAgent`
   - –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞

2. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:**
```kotlin
private fun buildSystemPrompt(): String {
    return """
        –¢—ã ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        
        ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –†–ê–ë–û–¢–ê –° –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê–ú–ò:
        
        - –£ —Ç–µ–±—è –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
        - –ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–º–µ–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—ä—è—Å–Ω—è–µ—Ç –µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        - –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–û —á–∏—Ç–∞–π –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
        - –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
        - –ï—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π –∏—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        
        ‚ö†Ô∏è –ö–û–ù–¢–ï–ö–°–¢ –í–†–ï–ú–ï–ù–ò:
        
        –¢–ï–ö–£–©–ï–ï –í–†–ï–ú–Ø (–°–ï–ô–ß–ê–°): ${System.currentTimeMillis()} –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥
        
        –í—Å–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –ú–ò–õ–õ–ò–°–ï–ö–£–ù–î–ê–• (Unix timestamp * 1000).
        
        ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ü–†–û–í–ï–†–ö–ê –ò–°–¢–û–†–ò–ò –î–ò–ê–õ–û–ì–ê:
        
        - –ü–ï–†–ï–î –ö–ê–ñ–î–´–ú –≤—ã–∑–æ–≤–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—è–π –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –≤—ã—à–µ!
        - –ï—Å–ª–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —É–∂–µ –µ—Å—Ç—å –≤—ã–∑–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Å —Ç–µ–º–∏ –∂–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –ø–æ–ª—É—á–µ–Ω - –ù–ï –í–´–ó–´–í–ê–ô –ï–ì–û –ü–û–í–¢–û–†–ù–û!
        - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —É–∂–µ –µ—Å—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ - –∏—Å–ø–æ–ª—å–∑—É–π –µ–≥–æ, –ù–ï –≤—ã–∑—ã–≤–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–Ω–æ–≤–∞!
        
        ‚ö†Ô∏è –û–†–ö–ï–°–¢–†–ê–¶–ò–Ø –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í:
        
        - –¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
        - –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ö–æ–¥–æ–º –¥–ª—è –¥—Ä—É–≥–æ–≥–æ
        - –ü–ª–∞–Ω–∏—Ä—É–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        - –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞–≥–æ–≤ ‚Äî –≤—ã–ø–æ–ª–Ω—è–π –∏—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É
        
        ‚ö†Ô∏è –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
        
        - –í—Å–µ–≥–¥–∞ –¥–∞–≤–∞–π –ø–æ–Ω—è—Ç–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        - –û–±—ä—è—Å–Ω—è–π, –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –∏ —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å
        - –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ‚Äî –æ–±—ä—è—Å–Ω–∏, —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
        
        –†–ê–ë–û–¢–ê –° –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê–ú–ò:
        
        –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∏—Å–ø–æ–ª—å–∑—É–π function calling –º–µ—Ö–∞–Ω–∏–∑–º.
        –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –µ–≥–æ –∏ —Ä–µ—à–∞–π:
        - –ù—É–∂–Ω–æ –ª–∏ –≤—ã–∑–≤–∞—Ç—å –µ—â—ë –æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç?
        - –ú–æ–∂–Ω–æ –ª–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é?
    """.trimIndent()
}
```

**–í–∞–∂–Ω–æ:**
- –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç **–ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** (get_chat_history, analyze_sentiment –∏ —Ç.–¥.)
- –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π –≤ MCP —Å–µ—Ä–≤–µ—Ä–∞—Ö
- LLM —Å–∞–º–∞ –∏–∑—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
server/
‚îú‚îÄ‚îÄ src/main/kotlin/com/prike/
‚îÇ   ‚îî‚îÄ‚îÄ domain/
‚îÇ       ‚îî‚îÄ‚îÄ agent/
‚îÇ           ‚îî‚îÄ‚îÄ OrchestrationAgent.kt
```

### –ö–æ–º–º–∏—Ç 6: API –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

–°–æ–∑–¥–∞—Ç—å API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∞–≥–µ–Ω—Ç–æ–º:

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. `ChatController` ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è —á–∞—Ç–∞
   - `POST /api/chat/message` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≥–µ–Ω—Ç—É
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Ç–∞–π–º–∞—É—Ç 120 —Å–µ–∫—É–Ω–¥)
   - –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ WebSocket –∏–ª–∏ polling)

2. DTO:
```kotlin
data class ChatMessageRequestDto(
    val message: String
)

data class ChatMessageResponseDto(
    val message: String,
    val toolCalls: List<ToolCallInfo>,
    val processingTime: Long  // –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
)

data class ToolCallInfo(
    val toolName: String,
    val serverId: String,
    val arguments: JsonObject,
    val result: String?,
    val success: Boolean
)
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
server/
‚îú‚îÄ‚îÄ src/main/kotlin/com/prike/
‚îÇ   ‚îî‚îÄ‚îÄ presentation/
‚îÇ       ‚îú‚îÄ‚îÄ controller/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ ChatController.kt
‚îÇ       ‚îî‚îÄ‚îÄ dto/
‚îÇ           ‚îú‚îÄ‚îÄ ChatMessageRequestDto.kt
‚îÇ           ‚îî‚îÄ‚îÄ ChatMessageResponseDto.kt
```

### –ö–æ–º–º–∏—Ç 7: UI - —á–∞—Ç —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏:

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. –ß–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–∞
2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å–µ—Ä–≤–µ—Ä–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞)
3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–ª–æ—É: –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—ã–∑—ã–≤–∞–ª–∏—Å—å –∏ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ
5. –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ MCP —Å–µ—Ä–≤–µ—Ä–∞–º

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
client/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ style.css
‚îî‚îÄ‚îÄ app.js
```

**UI —ç–ª–µ–º–µ–Ω—Ç—ã:**
- –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ (—Å—Ç–∞—Ç—É—Å, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
- –ß–∞—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- –ü–∞–Ω–µ–ª—å "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã" (—Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å–µ—Ä–≤–µ—Ä–∞)
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–ª–æ—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é —Ç–µ–∫—Å—Ç–æ–≤—É—é)

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lesson-14-orchestration/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ THEORY.md
‚îú‚îÄ‚îÄ PROMPT.md
‚îú‚îÄ‚îÄ example.env
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ mcp-servers.yaml
‚îÇ   ‚îú‚îÄ‚îÄ server.yaml
‚îÇ   ‚îú‚îÄ‚îÄ data-collection-mcp-server.yaml
‚îÇ   ‚îú‚îÄ‚îÄ data-processing-mcp-server.yaml
‚îÇ   ‚îî‚îÄ‚îÄ reporting-mcp-server.yaml
‚îú‚îÄ‚îÄ mcp-servers/
‚îÇ   ‚îú‚îÄ‚îÄ data-collection-mcp-server-1.0.0.jar
‚îÇ   ‚îú‚îÄ‚îÄ data-processing-mcp-server-1.0.0.jar
‚îÇ   ‚îî‚îÄ‚îÄ reporting-mcp-server-1.0.0.jar
‚îú‚îÄ‚îÄ data-collection-mcp-server/
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/...
‚îú‚îÄ‚îÄ data-processing-mcp-server/
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/...
‚îú‚îÄ‚îÄ reporting-mcp-server/
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/...
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/...
‚îî‚îÄ‚îÄ client/
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ style.css
    ‚îî‚îÄ‚îÄ app.js
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

```env
# LLM
OPENROUTER_API_KEY=your_openrouter_api_key
OPENROUTER_MODEL=gpt-4o-mini  # –∏–ª–∏ –¥—Ä—É–≥–∞—è –º–æ–¥–µ–ª—å —Å function calling

# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_GROUP_ID=your_telegram_group_id  # ID –≥—Ä—É–ø–ø—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
TELEGRAM_CHAT_ID=your_telegram_chat_id  # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

# –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–≤–æ–∏ –ø—É—Ç–∏)
CHAT_HISTORY_DB_PATH=../lesson-09-web-chat-memory/data/memory.db
TELEGRAM_MESSAGES_DB_PATH=../lesson-12-reminder-mcp/data/summary.db  # –ë–î –∏–∑ lesson-12
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ (`config/mcp-servers.yaml`)

```yaml
mcp:
  servers:
    - id: "data-collection"
      name: "Data Collection MCP Server"
      description: "–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–≤–µ–±-—á–∞—Ç, Telegram, —Ñ–∞–π–ª—ã)"
      jarPath: "mcp-servers/data-collection-mcp-server-1.0.0.jar"
      configPath: "config/data-collection-mcp-server.yaml"
      type: "local"
      tools:
        - get_chat_history
        - get_telegram_messages
        - get_file_content
    
    - id: "data-processing"
      name: "Data Processing MCP Server"
      description: "–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)"
      jarPath: "mcp-servers/data-processing-mcp-server-1.0.0.jar"
      configPath: "config/data-processing-mcp-server.yaml"
      type: "local"
      tools:
        - analyze_sentiment
        - extract_keywords
        - calculate_statistics
    
    - id: "reporting"
      name: "Reporting MCP Server"
      description: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –∏ –∏—Ö –¥–æ—Å—Ç–∞–≤–∫–∞ (—Ñ–∞–π–ª—ã, Telegram)"
      jarPath: "mcp-servers/reporting-mcp-server-1.0.0.jar"
      configPath: "config/reporting-mcp-server.yaml"
      type: "local"
      tools:
        - generate_report
        - save_to_file
        - send_telegram_message
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

- **–ù–ï —É–ø–æ–º–∏–Ω–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã** (get_chat_history, analyze_sentiment –∏ —Ç.–¥.)
- **–ù–ï –∑–Ω–∞–µ—Ç –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ MCP —Å–µ—Ä–≤–µ—Ä–æ–≤** (data-collection, data-processing –∏ —Ç.–¥.)
- –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π –≤ MCP —Å–µ—Ä–≤–µ—Ä–∞—Ö
- LLM —Å–∞–º–∞ –∏–∑—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

### 2. –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ MCP —Å–µ—Ä–≤–µ—Ä–∞—Ö

–ö–∞–∂–¥—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å:
- **–ü–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ** (`description`) ‚Äî —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
- **–î–µ—Ç–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** (`inputSchema`) ‚Äî –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω—É–∂–Ω—ã –∏ –∑–∞—á–µ–º
- **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** (–≤ –æ–ø–∏—Å–∞–Ω–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ü—Ä–∏–º–µ—Ä:
```kotlin
// –•—ç–Ω–¥–ª–µ—Ä –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ToolHandler
class GetChatHistoryHandler(
    private val repository: ChatHistoryRepository
) : ToolHandler<GetChatHistoryHandler.Params, List<ChatMessage>>() {
    
    override val logger = LoggerFactory.getLogger(GetChatHistoryHandler::class.java)
    
    override fun execute(params: Params): List<ChatMessage> {
        return repository.getMessagesBetween(params.startTime, params.endTime)
    }
    
    override fun prepareResult(request: Params, result: List<ChatMessage>): TextContent {
        val json = Json.encodeToString(result)
        return TextContent(text = json)
    }
    
    data class Params(
        val startTime: Long,
        val endTime: Long
    )
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
server.addTool(
    name = "get_chat_history",
    description = """
        –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∏–∑ –≤–µ–±-—á–∞—Ç–∞ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ä–æ–ª—è–º–∏ (user/assistant) –∏ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º.
        
        –ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É –∏–∑ –≤–µ–±-—á–∞—Ç–∞.
        –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
        
        –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
        - startTime: –Ω–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (Unix timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
        - endTime: –∫–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (Unix timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
        
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –º–∞—Å—Å–∏–≤ —Å–æ–æ–±—â–µ–Ω–∏–π:
        [{"role": "user|assistant", "content": "...", "timestamp": ...}]
    """.trimIndent(),
    inputSchema = Tool.Input(
        properties = buildJsonObject {
            putJsonObject("startTime") {
                put("type", "number")
                put("description", "–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (Unix timestamp * 1000)")
            }
            putJsonObject("endTime") {
                put("type", "number")
                put("description", "–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (Unix timestamp * 1000)")
            }
        },
        required = listOf("startTime", "endTime")
    )
) { request ->
    val params = GetChatHistoryHandler.Params(
        startTime = extractLong(request.arguments, "startTime"),
        endTime = extractLong(request.arguments, "endTime")
    )
    handler.handle(params)
}
```

### 3. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

- LLM –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ
- `MCPClientManager` –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É remote MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ (—á–µ—Ä–µ–∑ SSE/WebSocket)
- –î–ª—è —ç—Ç–æ–≥–æ —É—Ä–æ–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ local —Å–µ—Ä–≤–µ—Ä–æ–≤ (JAR —Ñ–∞–π–ª—ã)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å (–æ–¥–∏–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ–ª—É—á–∏ –ø–µ—Ä–µ–ø–∏—Å–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞"

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç get_chat_history –∏–∑ data-collection —Å–µ—Ä–≤–µ—Ä–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### –¢–µ—Å—Ç 2: –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π"

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç get_chat_history (data-collection)
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç analyze_sentiment (data-processing) —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–∑–æ–≤–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### –¢–µ—Å—Ç 3: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–µ—Ä–µ–ø–∏—Å–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π, –∏–∑–≤–ª–µ–∫–∏ –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã, 
                —Ä–∞—Å—Å—á–∏—Ç–∞–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –æ—Ç—á—ë—Ç –≤ Telegram"

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç get_chat_history (data-collection)
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç extract_keywords (data-processing)
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç calculate_statistics (data-processing)
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç generate_report (reporting)
- LLM –≤—ã–∑—ã–≤–∞–µ—Ç send_telegram_message (reporting, userId –∏–∑ TELEGRAM_CHAT_ID)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### –¢–µ—Å—Ç 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–û—Ç–ø—Ä–∞–≤—å –º–Ω–µ –æ—Ç—á—ë—Ç –æ –ø–µ—Ä–µ–ø–∏—Å–∫–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥"

–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî LLM —Å–æ–æ–±—â–∞–µ—Ç –æ–± —ç—Ç–æ–º
- –ï—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É ‚Äî LLM –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ—ë –∏ —Å–æ–æ–±—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

---

## üìù –ß–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] MCP Server - Data Collection (3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞)
- [ ] MCP Server - Data Processing (3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞)
- [ ] MCP Server - Reporting (3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞)
- [ ] MCPClientManager (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏)
- [ ] MCPToolAgent (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
- [ ] OrchestrationAgent (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç)
- [ ] API –¥–ª—è —á–∞—Ç–∞
- [ ] UI —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
- [ ] –¢–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

---

## üîç –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ MCP —Å–µ—Ä–≤–µ—Ä–∞—Ö

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í—Å–µ –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –≤ `stderr`, –∞ –Ω–µ –≤ `stdout`!

–ù–∞—Å—Ç—Ä–æ–π `logback.xml`:
```xml
<configuration>
    <appender name="STDERR" class="ch.qos.logback.core.ConsoleAppender">
        <target>System.err</target>
        <encoder>
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    
    <root level="INFO">
        <appender-ref ref="STDERR" />
    </root>
</configuration>
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ï—Å–ª–∏ MCP —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –ª–æ–≥–∏—Ä—É–π –æ—à–∏–±–∫—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–π —Ä–∞–±–æ—Ç—É —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- –ï—Å–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞–π –µ—ë –≤ LLM, –ø—É—Å—Ç—å –æ–Ω–∞ —Ä–µ—à–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å
- –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–π –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (30 —Å–µ–∫—É–Ω–¥)

---

## üéì –ß—Ç–æ –∏–∑—É—á–∏–º

1. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
2. –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∑–Ω–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
3. –ö–∞–∫ LLM —Å–∞–º–∞ –∏–∑—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
4. –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–π —Ñ–ª–æ—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
5. –ö–∞–∫ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!** üöÄ

