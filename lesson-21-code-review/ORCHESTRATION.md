# ๐ผ ะัะบะตัััะฐัะธั ัะธััะตะผั "ะััะธััะตะฝั ัะฐะทัะฐะฑะพััะธะบะฐ"

## ๐ ะกะพะดะตัะถะฐะฝะธะต
1. [ะขะตะบััะฐั ะฐััะธัะตะบัััะฐ ะพัะบะตัััะฐัะธะธ](#ัะตะบััะฐั-ะฐััะธัะตะบัััะฐ-ะพัะบะตัััะฐัะธะธ)
2. [ะัะพะฑะปะตะผั ัะตะบััะตะณะพ ะฟะพะดัะพะดะฐ](#ะฟัะพะฑะปะตะผั-ัะตะบััะตะณะพ-ะฟะพะดัะพะดะฐ)
3. [ะะดะตะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ ะพัะบะตัััะฐัะธะธ](#ะธะดะตะฐะปัะฝะฐั-ะฐััะธัะตะบัััะฐ-ะพัะบะตัััะฐัะธะธ)
4. [ะะฐัะธะฐะฝัั ัะตะฐะปะธะทะฐัะธะธ](#ะฒะฐัะธะฐะฝัั-ัะตะฐะปะธะทะฐัะธะธ)
5. [ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะทะฐะฟััะบั RAG](#ัะตะบะพะผะตะฝะดะฐัะธะธ-ะฟะพ-ะทะฐะฟััะบั-rag)
6. [ะะปะฐะฝ ะผะธะณัะฐัะธะธ](#ะฟะปะฐะฝ-ะผะธะณัะฐัะธะธ)

---

## ะขะตะบััะฐั ะฐััะธัะตะบัััะฐ ะพัะบะตัััะฐัะธะธ

### ะะฐะบ ัะฐะฑะพัะฐะตั ัะตะนัะฐั:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ะัะฝะพะฒะฝะพะน ัะตัะฒะตั (Ktor)          โ
โ  - HTTP API                             โ
โ  - ะฃะฟัะฐะฒะปะตะฝะธะต ัะตััะธัะผะธ                  โ
โ  - LLM Service                          โ
โ  - Request Router (LLM-based)           โ
โ                                         โ
โ  ะัะธ ััะฐััะต:                            โ
โ  1. ะะฐะฟััะบะฐะตั Git MCP Server (ะฟัะพัะตัั) โ
โ  2. ะะฐะฟััะบะฐะตั RAG MCP Server (ะฟัะพัะตัั)  โ
โ  3. ะะพะดะบะปััะฐะตััั ะบ ะฝะธะผ ัะตัะตะท stdio     โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ MCP Protocol (stdio)
               โ
       โโโโโโโโโดโโโโโโโโ
       โ               โ
   โโโโโผโโโโโโโ  โโโโโโผโโโโโโโ
   โ Git MCP  โ  โ  RAG MCP  โ
   โ Server   โ  โ  Server   โ
   โ          โ  โ            โ
   โ - branch โ  โ - search   โ
   โ - read   โ  โ - index    โ
   โ - list   โ  โ - rerank   โ
   โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
```

### ะัะพะฑะปะตะผั:

1. **ะะฐะถะดัะน ัะฐะท ะทะฐะฟััะบะฐะตััั ะฝะพะฒัะน ะฟัะพัะตัั** - ะฟัะธ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต ะธะปะธ ะฟะตัะตะทะฐะฟััะบะต ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ
2. **ะะตั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะพะตะดะธะฝะตะฝะธะน** - ะบะฐะถะดัะน ัะฐะท ะฝะพะฒะพะต stdio ัะพะตะดะธะฝะตะฝะธะต
3. **ะะตััะบะฐั ะฟัะธะฒัะทะบะฐ** - ะพัะฝะพะฒะฝะพะน ัะตัะฒะตั ะทะฝะฐะตั ะพ ะบะพะฝะบัะตัะฝัั MCP ัะตัะฒะตัะฐั
4. **ะะตั ะดะธะฝะฐะผะธัะตัะบะพะณะพ ะพะฑะฝะฐััะถะตะฝะธั** - ะฝะตะปัะทั ะดะพะฑะฐะฒะธัั ะฝะพะฒัะน MCP ัะตัะฒะตั ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ

---

## ะัะพะฑะปะตะผั ัะตะบััะตะณะพ ะฟะพะดัะพะดะฐ

### 1. ะะฐะฟััะบ RAG ะบะฐะถะดัะน ัะฐะท

**ะขะตะบััะฐั ัะธััะฐัะธั:**
- ะัะธ ััะฐััะต ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ ะทะฐะฟััะบะฐะตััั ะฟัะพัะตัั `rag-mcp-server`
- ะัะพัะตัั ัะฐะฑะพัะฐะตั ะดะพ ะพััะฐะฝะพะฒะบะธ ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ
- ะัะธ ะฟะตัะตะทะฐะฟััะบะต ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ RAG ะฟะตัะตะทะฐะฟััะบะฐะตััั

**ะัะพะฑะปะตะผั:**
- โ ะะพะปะณะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั RAG (ะทะฐะณััะทะบะฐ ะผะพะดะตะปะตะน, ะฟะพะดะบะปััะตะฝะธะต ะบ ะะ)
- โ ะะพัะตัั ะบััะฐ ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต
- โ ะัะฑะปะธัะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ, ะตัะปะธ ะทะฐะฟััะตะฝะพ ะฝะตัะบะพะปัะบะพ ัะบะทะตะผะฟะปััะพะฒ ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ

### 2. ะะตััะบะฐั ะพัะบะตัััะฐัะธั

**ะขะตะบััะฐั ัะธััะฐัะธั:**
```kotlin
// Main.kt
val gitMCPService = GitMCPService(...)
val ragMCPService = RagMCPService(...)
val requestRouter = RequestRouterService(gitMCPService, ragMCPService)
```

**ะัะพะฑะปะตะผั:**
- โ ะัะถะฝะพ ัะฒะฝะพ ัะพะทะดะฐะฒะฐัั ะบะฐะถะดัะน ัะตัะฒะธั
- โ ะัะถะฝะพ ะฟะตัะตะดะฐะฒะฐัั ะฒ RequestRouterService
- โ ะะตะฒะพะทะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะน MCP ัะตัะฒะตั ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ

---

## ะะดะตะฐะปัะฝะฐั ะฐััะธัะตะบัััะฐ ะพัะบะตัััะฐัะธะธ

### ะะพะฝัะตะฟัะธั "ะะพะฝััััะบัะพัะฐ"

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      ะัะบะตัััะฐัะพั (Service Manager)      โ
โ                                         โ
โ  - Service Discovery                    โ
โ  - Connection Pooling                  โ
โ  - Health Monitoring                   โ
โ  - Dynamic Tool Registration           โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ ะะฑะฝะฐััะถะตะฝะธะต ัะตัะฒะธัะพะฒ
               โ
       โโโโโโโโโดโโโโโโโโ
       โ               โ
   โโโโโผโโโโโโโ  โโโโโโผโโโโโโโ
   โ Git MCP  โ  โ  RAG MCP  โ
   โ (Long-   โ  โ  (Long-   โ
   โ  running)โ  โ  running) โ
   โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
```

### ะัะธะฝัะธะฟั:

1. **Long-running ะฟัะพัะตััั** - MCP ัะตัะฒะตัั ะทะฐะฟััะบะฐัััั ะพะดะธะฝ ัะฐะท ะธ ัะฐะฑะพัะฐัั ะฟะพััะพัะฝะฝะพ
2. **Service Discovery** - ะพัะบะตัััะฐัะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั ะดะพัััะฟะฝัะต MCP ัะตัะฒะตัั
3. **Connection Pooling** - ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธะน ะบ MCP ัะตัะฒะตัะฐะผ
4. **Plugin Architecture** - ะบะฐะถะดัะน MCP ัะตัะฒะตั - ััะพ ะฟะปะฐะณะธะฝ, ะบะพัะพััะน ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั/ัะดะฐะปะธัั

---

## ะะฐัะธะฐะฝัั ัะตะฐะปะธะทะฐัะธะธ

### ะะฐัะธะฐะฝั 1: Long-running MCP ัะตัะฒะตัั (ะะตะบะพะผะตะฝะดัะตััั)

**ะะดะตั:** MCP ัะตัะฒะตัั ะทะฐะฟััะบะฐัััั ะบะฐะบ ะพัะดะตะปัะฝัะต ะดะพะปะณะพะถะธะฒััะธะต ะฟัะพัะตััั (systemd, docker, supervisor).

**ะััะธัะตะบัััะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      ะัะฝะพะฒะฝะพะน ัะตัะฒะตั (Ktor)             โ
โ                                         โ
โ  - MCP Service Manager                  โ
โ    - ะะพะดะบะปััะฐะตััั ะบ ัะถะต ะทะฐะฟััะตะฝะฝัะผ     โ
โ      MCP ัะตัะฒะตัะฐะผ ัะตัะตะท stdio/socket    โ
โ    - ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั        โ
โ      ะดะพัััะฟะฝัะต ะธะฝััััะผะตะฝัั             โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ ะะพะดะบะปััะตะฝะธะต ะบ ัััะตััะฒัััะธะผ ะฟัะพัะตััะฐะผ
               โ
       โโโโโโโโโดโโโโโโโโ
       โ               โ
   โโโโโผโโโโโโโ  โโโโโโผโโโโโโโ
   โ Git MCP  โ  โ  RAG MCP  โ
   โ (systemd)โ  โ  (systemd)โ
   โ          โ  โ            โ
   โ ะะฐะฟััะตะฝ  โ  โ ะะฐะฟััะตะฝ    โ
   โ ะฟะพััะพัะฝะฝะพโ  โ ะฟะพััะพัะฝะฝะพ  โ
   โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ RAG ะฝะต ะฟะตัะตะทะฐะฟััะบะฐะตััั ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ
- โ ะััััะพะต ะฟะพะดะบะปััะตะฝะธะต (ะฝะตั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ)
- โ ะกะพััะฐะฝะตะฝะธะต ะบััะฐ ะธ ัะพััะพัะฝะธั
- โ ะะพะถะฝะพ ะทะฐะฟัััะธัั ะฝะตัะบะพะปัะบะพ ัะบะทะตะผะฟะปััะพะฒ ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ ะัะถะฝะฐ ะฝะฐัััะพะนะบะฐ systemd/docker
- โ๏ธ ะฃะฟัะฐะฒะปะตะฝะธะต ะฟัะพัะตััะฐะผะธ ะฒัััะฝัั

**ะะตะฐะปะธะทะฐัะธั:**
```kotlin
// MCP Service Manager
class MCPServiceManager {
    private val services = mutableMapOf<String, MCPService>()
    
    // ะะพะดะบะปััะตะฝะธะต ะบ ัะถะต ะทะฐะฟััะตะฝะฝัะผ ัะตัะฒะตัะฐะผ
    suspend fun connectToService(name: String, connectionString: String) {
        val service = when (name) {
            "git" -> GitMCPService.connect(connectionString)
            "rag" -> RagMCPService.connect(connectionString)
            else -> throw IllegalArgumentException("Unknown service: $name")
        }
        services[name] = service
    }
    
    // ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต ะฒัะตั ะธะฝััััะผะตะฝัะพะฒ
    suspend fun discoverAllTools(): List<MCPTool> {
        return services.values.flatMap { it.listTools() }
    }
}
```

---

### ะะฐัะธะฐะฝั 2: Connection Pooling ั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะฟัะพัะตััะพะฒ

**ะะดะตั:** ะัะฝะพะฒะฝะพะน ัะตัะฒะตั ะทะฐะฟััะบะฐะตั MCP ัะตัะฒะตัั ะพะดะธะฝ ัะฐะท ะธ ะฟะตัะตะธัะฟะพะปัะทัะตั ัะพะตะดะธะฝะตะฝะธั.

**ะััะธัะตะบัััะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      ะัะฝะพะฒะฝะพะน ัะตัะฒะตั (Ktor)             โ
โ                                         โ
โ  - MCP Service Pool                     โ
โ    - ะะฐะฟััะบะฐะตั ะฟัะพัะตััั ะฟัะธ ััะฐััะต     โ
โ    - ะะพะดะดะตัะถะธะฒะฐะตั ะฟัะป ัะพะตะดะธะฝะตะฝะธะน        โ
โ    - ะะตัะตะธัะฟะพะปัะทัะตั ะฟัะพัะตััั            โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ ะะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ
               โ
       โโโโโโโโโดโโโโโโโโ
       โ               โ
   โโโโโผโโโโโโโ  โโโโโโผโโโโโโโ
   โ Git MCP  โ  โ  RAG MCP  โ
   โ (ะฟัะพัะตัั)โ  โ  (ะฟัะพัะตัั) โ
   โ          โ  โ            โ
   โ ะะดะธะฝ ัะฐะท โ  โ ะะดะธะฝ ัะฐะท   โ
   โ ะทะฐะฟััะตะฝ  โ  โ ะทะฐะฟััะตะฝ    โ
   โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะัะพัะต ัะฟัะฐะฒะปะตะฝะธะต (ะฒัะต ะธะท ะพะดะฝะพะณะพ ะผะตััะฐ)
- โ ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ/ะพััะฐะฝะพะฒะบะฐ
- โ ะะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ ะัะธ ะฟะตัะตะทะฐะฟััะบะต ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ ัะตััะตััั ัะพััะพัะฝะธะต RAG
- โ๏ธ ะัะถะฝะพ ะฟัะฐะฒะธะปัะฝะพ ัะฟัะฐะฒะปััั ะถะธะทะฝะตะฝะฝัะผ ัะธะบะปะพะผ ะฟัะพัะตััะพะฒ

**ะะตะฐะปะธะทะฐัะธั:**
```kotlin
// MCP Service Pool
class MCPServicePool {
    private val processes = mutableMapOf<String, Process>()
    private val connections = mutableMapOf<String, MCPConnection>()
    
    suspend fun getOrCreateService(name: String): MCPService {
        if (!processes.containsKey(name)) {
            val process = startMCPServer(name)
            processes[name] = process
            connections[name] = connectToProcess(process)
        }
        return createService(connections[name]!!)
    }
    
    fun shutdown() {
        processes.values.forEach { it.destroy() }
    }
}
```

---

### ะะฐัะธะฐะฝั 3: Plugin Architecture ั ะดะธะฝะฐะผะธัะตัะบะธะผ ะพะฑะฝะฐััะถะตะฝะธะตะผ

**ะะดะตั:** ะกะธััะตะผะฐ ะฟะปะฐะณะธะฝะพะฒ, ะณะดะต ะบะฐะถะดัะน MCP ัะตัะฒะตั ัะตะณะธัััะธััะตััั ัะตัะตะท ะบะพะฝัะธะณััะฐัะธั ะธะปะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ.

**ะััะธัะตะบัััะฐ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      ะัะฝะพะฒะฝะพะน ัะตัะฒะตั (Ktor)             โ
โ                                         โ
โ  - Plugin Manager                       โ
โ    - ะะฐะณััะถะฐะตั ะฟะปะฐะณะธะฝั ะธะท ะบะพะฝัะธะณะฐ      โ
โ    - ะะธะฝะฐะผะธัะตัะบะธ ัะตะณะธัััะธััะตั          โ
โ    - ะะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะฐััะถะธะฒะฐะตั        โ
โ      ะธะฝััััะผะตะฝัั                        โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โ ะะธะฝะฐะผะธัะตัะบะฐั ะทะฐะณััะทะบะฐ
               โ
       โโโโโโโโโดโโโโโโโโ
       โ               โ
   โโโโโผโโโโโโโ  โโโโโโผโโโโโโโ
   โ Git      โ  โ  RAG      โ
   โ Plugin   โ  โ  Plugin   โ
   โ          โ  โ            โ
   โ ะะฐะณััะถะตะฝ โ  โ ะะฐะณััะถะตะฝ   โ
   โ ะดะธะฝะฐะผะธัะตัะบะธโ โ ะดะธะฝะฐะผะธัะตัะบะธโ
   โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะะพะปะฝะฐั ะผะพะดัะปัะฝะพััั
- โ ะะพะถะฝะพ ะดะพะฑะฐะฒะปััั ะฟะปะฐะณะธะฝั ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ
- โ ะะธะฑะบะฐั ะบะพะฝัะธะณััะฐัะธั

**ะะตะดะพััะฐัะบะธ:**
- โ๏ธ ะะพะปะตะต ัะปะพะถะฝะฐั ัะตะฐะปะธะทะฐัะธั
- โ๏ธ ะัะถะฝะฐ ัะธััะตะผะฐ ะทะฐะณััะทะบะธ ะฟะปะฐะณะธะฝะพะฒ

**ะะตะฐะปะธะทะฐัะธั:**
```kotlin
// Plugin Manager
class MCPPluginManager {
    private val plugins = mutableMapOf<String, MCPPlugin>()
    
    fun loadPlugins(config: PluginConfig) {
        config.plugins.forEach { pluginConfig ->
            val plugin = when (pluginConfig.type) {
                "git" -> GitMCPPlugin(pluginConfig)
                "rag" -> RagMCPPlugin(pluginConfig)
                else -> throw IllegalArgumentException("Unknown plugin type: ${pluginConfig.type}")
            }
            plugins[pluginConfig.name] = plugin
        }
    }
    
    suspend fun getAllTools(): List<MCPTool> {
        return plugins.values.flatMap { it.listTools() }
    }
}
```

---

## ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะทะฐะฟััะบั RAG

### โ ะัะถะฝะพ ะปะธ ะบะฐะถะดัะน ัะฐะท ะทะฐะฟััะบะฐัั RAG?

**ะัะฒะตั: ะะะข, ะฝะต ะฝัะถะฝะพ!**

### ะะพัะตะผั:

1. **ะะพะปะณะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั:**
   - ะะฐะณััะทะบะฐ ะผะพะดะตะปะตะน ัะผะฑะตะดะดะธะฝะณะพะฒ
   - ะะพะดะบะปััะตะฝะธะต ะบ ะฑะฐะทะต ะดะฐะฝะฝัั
   - ะะฝะธัะธะฐะปะธะทะฐัะธั ะธะฝะดะตะบัะพะฒ
   - ะะพะถะตั ะทะฐะฝะธะผะฐัั 5-30 ัะตะบัะฝะด

2. **ะะพัะตัั ะบััะฐ:**
   - ะัั ัะผะฑะตะดะดะธะฝะณะพะฒ
   - ะัั ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ
   - ะกะพััะพัะฝะธะต ะธะฝะดะตะบัะฐัะธะธ

3. **ะะตััััั:**
   - ะะฐะถะดัะน ะฟัะพัะตัั ะฟะพััะตะฑะปัะตั ะฟะฐะผััั
   - ะัะฑะปะธัะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ ะฟัะธ ะฝะตัะบะพะปัะบะธั ัะบะทะตะผะฟะปััะฐั

### โ ะะตะบะพะผะตะฝะดัะตะผัะน ะฟะพะดัะพะด:

**Long-running RAG ะฟัะพัะตัั:**

```bash
# systemd service ะดะปั RAG MCP Server
[Unit]
Description=RAG MCP Server
After=network.target

[Service]
Type=simple
User=dev
WorkingDirectory=/path/to/lesson-21-code-review/rag-mcp-server
ExecStart=/usr/bin/java -jar rag-mcp-server-1.0.0.jar
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**ะัะฝะพะฒะฝะพะน ัะตัะฒะตั ะฟะพะดะบะปััะฐะตััั ะบ ัะถะต ะทะฐะฟััะตะฝะฝะพะผั ะฟัะพัะตััั:**

```kotlin
// Main.kt
val ragMCPService = RagMCPService.connectToExisting(
    connectionString = "stdio://rag-mcp-server" // ะธะปะธ socket://localhost:8081
)
```

---

## ะะปะฐะฝ ะผะธะณัะฐัะธะธ

### ะญัะฐะฟ 1: ะะตัะฐะบัะพัะธะฝะณ Service Manager

1. ะกะพะทะดะฐัั `MCPServiceManager` ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฒัะตะผะธ MCP ัะตัะฒะธัะฐะผะธ
2. ะัะฝะตััะธ ะปะพะณะธะบั ะฟะพะดะบะปััะตะฝะธั ะฒ ะพัะดะตะปัะฝัะน ะบะปะฐัั
3. ะะพะฑะฐะฒะธัั ะฟะพะดะดะตัะถะบั ะฟะพะดะบะปััะตะฝะธั ะบ ัััะตััะฒัััะธะผ ะฟัะพัะตััะฐะผ

### ะญัะฐะฟ 2: Connection Pooling

1. ะะตะฐะปะธะทะพะฒะฐัั ะฟัะป ัะพะตะดะธะฝะตะฝะธะน ะบ MCP ัะตัะฒะตัะฐะผ
2. ะะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพัะตััะพะฒ ะผะตะถะดั ะทะฐะฟัะพัะฐะผะธ
3. Health checks ะดะปั ะฟัะพะฒะตัะบะธ ะดะพัััะฟะฝะพััะธ ัะตัะฒะธัะพะฒ

### ะญัะฐะฟ 3: Service Discovery

1. ะะพะฝัะธะณััะฐัะธั ัะตัะตะท YAML/JSON
2. ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต ะดะพัััะฟะฝัั MCP ัะตัะฒะตัะพะฒ
3. ะะธะฝะฐะผะธัะตัะบะฐั ัะตะณะธัััะฐัะธั ะธะฝััััะผะตะฝัะพะฒ

### ะญัะฐะฟ 4: Plugin Architecture

1. ะกะธััะตะผะฐ ะฟะปะฐะณะธะฝะพะฒ ะดะปั MCP ัะตัะฒะตัะพะฒ
2. Hot-reload ะฟะปะฐะณะธะฝะพะฒ ะฑะตะท ะฟะตัะตะทะฐะฟััะบะฐ
3. ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ะฟะปะฐะณะธะฝะพะฒ

---

## ะะตะบะพะผะตะฝะดะฐัะธะธ

### ะัะฐัะบะพััะพัะฝัะต (ัะตะนัะฐั):

1. **ะะทะผะตะฝะธัั ะทะฐะฟััะบ RAG ะฝะฐ long-running:**
   - ะะฐะฟััะบะฐัั RAG MCP Server ะบะฐะบ ะพัะดะตะปัะฝัะน ะฟัะพัะตัั (systemd/docker)
   - ะัะฝะพะฒะฝะพะน ัะตัะฒะตั ะฟะพะดะบะปััะฐะตััั ะบ ัะถะต ะทะฐะฟััะตะฝะฝะพะผั ะฟัะพัะตััั
   - ะญัะพ ััััะฐะฝะธั ะฟัะพะฑะปะตะผั ะฟะตัะตะทะฐะฟััะบะฐ RAG

2. **ะกะพะทะดะฐัั MCPServiceManager:**
   - ะะดะธะฝะฐั ัะพัะบะฐ ัะฟัะฐะฒะปะตะฝะธั ะฒัะตะผะธ MCP ัะตัะฒะธัะฐะผะธ
   - ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต ะธะฝััััะผะตะฝัะพะฒ
   - ะฃะฟัะพััะธั ะดะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะตัะฒะธัะพะฒ

### ะะพะปะณะพััะพัะฝัะต (ะฑัะดััะตะต):

1. **Service Discovery:**
   - ะะฒัะพะผะฐัะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต ะดะพัััะฟะฝัั MCP ัะตัะฒะตัะพะฒ
   - ะะพะฝัะธะณััะฐัะธั ัะตัะตะท ัะฐะนะปั ะธะปะธ ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
   - ะะพะดะดะตัะถะบะฐ ะฝะตัะบะพะปัะบะธั ัะบะทะตะผะฟะปััะพะฒ ะพะดะฝะพะณะพ ัะตัะฒะธัะฐ

2. **Connection Pooling:**
   - ะัะป ัะพะตะดะธะฝะตะฝะธะน ะดะปั ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธั
   - Health checks ะธ ะฐะฒัะพะผะฐัะธัะตัะบะพะต ะฟะตัะตะฟะพะดะบะปััะตะฝะธะต
   - ะะฐะปะฐะฝัะธัะพะฒะบะฐ ะฝะฐะณััะทะบะธ ะผะตะถะดั ัะบะทะตะผะฟะปััะฐะผะธ

3. **Plugin Architecture:**
   - ะกะธััะตะผะฐ ะฟะปะฐะณะธะฝะพะฒ ะดะปั ะดะธะฝะฐะผะธัะตัะบะพะน ะทะฐะณััะทะบะธ MCP ัะตัะฒะตัะพะฒ
   - Hot-reload ะฑะตะท ะฟะตัะตะทะฐะฟััะบะฐ ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ
   - ะะตััะธะพะฝะธัะพะฒะฐะฝะธะต ะธ ะพะฑะฝะพะฒะปะตะฝะธะต ะฟะปะฐะณะธะฝะพะฒ

---

## ะัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ

### `config/mcp-services.yaml`:

```yaml
mcp:
  services:
    - name: "git"
      type: "git-mcp-server"
      connection:
        type: "stdio"  # ะธะปะธ "socket"
        path: "/usr/local/bin/git-mcp-server"  # ะดะปั stdio
        # host: "localhost"  # ะดะปั socket
        # port: 8081  # ะดะปั socket
      enabled: true
    
    - name: "rag"
      type: "rag-mcp-server"
      connection:
        type: "stdio"
        path: "/usr/local/bin/rag-mcp-server"
      enabled: true
      # RAG ะฝะต ะฟะตัะตะทะฐะฟััะบะฐะตััั ะฟัะธ ะฟะตัะตะทะฐะฟััะบะต ะพัะฝะพะฒะฝะพะณะพ ัะตัะฒะตัะฐ
      longRunning: true
    
    - name: "jira"  # ะัะธะผะตั ะฑัะดััะตะณะพ ะฟะปะฐะณะธะฝะฐ
      type: "jira-mcp-server"
      connection:
        type: "socket"
        host: "localhost"
        port: 8082
      enabled: false  # ะะพะถะฝะพ ะพัะบะปััะธัั ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ
```

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต:

```kotlin
// Main.kt
val mcpServiceManager = MCPServiceManager.fromConfig(config.mcp)
mcpServiceManager.connectAll()

val requestRouter = RequestRouterService(
    llmService = llmService,
    mcpServiceManager = mcpServiceManager  // ะะผะตััะพ ะบะพะฝะบัะตัะฝัั ัะตัะฒะธัะพะฒ
)
```

---

## ะัะฒะพะดั

1. **RAG ะฝะต ะฝัะถะฝะพ ะทะฐะฟััะบะฐัั ะบะฐะถะดัะน ัะฐะท** - ะปัััะต ะธัะฟะพะปัะทะพะฒะฐัั long-running ะฟัะพัะตัั
2. **ะัะบะตัััะฐัะธั ะดะพะปะถะฝะฐ ะฑััั ะผะพะดัะปัะฝะพะน** - ัะตัะตะท Service Manager ะธ ะบะพะฝัะธะณััะฐัะธั
3. **ะะธะฝะฐะผะธัะตัะบะพะต ะพะฑะฝะฐััะถะตะฝะธะต** - ะฐะฒัะพะผะฐัะธัะตัะบะฐั ัะตะณะธัััะฐัะธั ะธะฝััััะผะตะฝัะพะฒ
4. **Connection Pooling** - ะฟะตัะตะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะพะตะดะธะฝะตะฝะธะน ะดะปั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

ะญัะพ ะฟะพะทะฒะพะปะธั ัะพะทะดะฐัั ัะธััะตะผั, ะณะดะต ะบะฐะถะดัะน ะบะพะผะฟะพะฝะตะฝั - ััะพ ะฝะตะทะฐะฒะธัะธะผัะน "ะบััะพัะตะบ ะบะพะฝััััะบัะพัะฐ", ะบะพัะพััะน ะผะพะถะฝะพ ะปะตะณะบะพ ะดะพะฑะฐะฒะธัั, ัะดะฐะปะธัั ะธะปะธ ะทะฐะผะตะฝะธัั.

