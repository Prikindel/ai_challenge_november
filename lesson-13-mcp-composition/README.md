# üî• –î–µ–Ω—å 13. –ö–æ–º–ø–æ–∑–∏—Ü–∏—è MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞, –≥–¥–µ **LLM —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç**, –∫–∞–∫–∏–µ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—ã–∑—ã–≤–∞—Ç—å –∏ –≤ –∫–∞–∫–æ–º –ø–æ—Ä—è–¥–∫–µ (–∫–∞—Å–∫–∞–¥–Ω—ã–π –≤—ã–∑–æ–≤). –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω—É—é –∑–∞–¥–∞—á—É, LLM —Ä–∞–∑–±–∏–≤–∞–µ—Ç –µ—ë –Ω–∞ —à–∞–≥–∏ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —É—Ä–æ–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –≥–¥–µ:
- LLM –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ú—ã –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞ –¥–∞—ë–º LLM –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
- –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã: LLM ‚Üí –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 1 ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí LLM ‚Üí –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 2 ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí LLM ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

[–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∂–Ω–æ –∑–¥–µ—Å—å](https://disk.yandex.ru/i/mGjva_xjurKHNw)

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–ø–∏—Å–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ –∏ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ –≤ TG –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É"

–ò—Ç–µ—Ä–∞—Ü–∏—è 1:
  LLM: "–ú–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É"
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç get_chat_history(startTime, endTime)
  ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∫—É

–ò—Ç–µ—Ä–∞—Ü–∏—è 2:
  LLM: "–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Å—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –ø–µ—Ä–µ–ø–∏—Å–∫—É"
  ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç)
  ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–¥–∫—É

–ò—Ç–µ—Ä–∞—Ü–∏—è 3:
  LLM: "–ù—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–æ–¥–∫—É –≤ Telegram"
  ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç send_telegram_message(userId, summary)
  ‚Üí –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ò—Ç–µ—Ä–∞—Ü–∏—è 4:
  LLM: "–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, —Å–æ–æ–±—â–∞—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"
  ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: "–°–æ–±—Ä–∞–ª –ø–µ—Ä–µ–ø–∏—Å–∫—É, —Å—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞–ª –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –≤ –≤–∞—à Telegram"
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí ChatController ‚Üí LLMCompositionAgent
    ‚Üì
LLM (—Å tools) ‚Üí tool_call ‚Üí MCPToolAgent ‚Üí MCPClientManager ‚Üí MCP Server
    ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí LLM (—Å –∏—Å—Ç–æ—Ä–∏–µ–π) ‚Üí tool_call ‚Üí ... ‚Üí –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lesson-13-mcp-composition/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ THEORY.md
‚îú‚îÄ‚îÄ PROMPT.md
‚îú‚îÄ‚îÄ example.env
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ mcp-servers.yaml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ server.yaml                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ telegram-sender-mcp-server.yaml  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram MCP —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ mcp-servers/
‚îÇ   ‚îî‚îÄ‚îÄ telegram-sender-mcp-server-1.0.0.jar  # JAR —Ñ–∞–π–ª Telegram MCP —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ telegram-sender-mcp-server/       # MCP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/mcpserver/...
‚îú‚îÄ‚îÄ server/                           # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (MCP –∫–ª–∏–µ–Ω—Ç, –º–µ–Ω–µ–¥–∂–µ—Ä, LLM –∞–≥–µ–Ω—Ç, API)
‚îÇ   ‚îî‚îÄ‚îÄ src/main/kotlin/com/prike/...
‚îî‚îÄ‚îÄ client/                           # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ style.css
    ‚îî‚îÄ‚îÄ app.js
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (`ai_challenge_november/.env`):

```env
OPENAI_API_KEY=your_openai_api_key
OPENROUTER_API_KEY=your_openrouter_api_key
TELEGRAM_BOT_TOKEN=your_telegram_bot_token
TELEGRAM_USER_ID=your_telegram_user_id
```

### 2. –°–±–æ—Ä–∫–∞ JAR —Ñ–∞–π–ª–æ–≤

JAR —Ñ–∞–π–ª—ã —É–∂–µ —Å–æ–±—Ä–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- `mcp-servers/telegram-sender-mcp-server-1.0.0.jar` - Telegram MCP —Å–µ—Ä–≤–µ—Ä
- `server/build/libs/server-1.0.0.jar` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å:

```bash
# Telegram Sender MCP Server
cd telegram-sender-mcp-server
./gradlew build
cp build/libs/telegram-sender-mcp-server-1.0.0.jar ../mcp-servers/

# –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
cd ../server
./gradlew build
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ `config/mcp-servers.yaml`:

```yaml
mcp:
  servers:
    - id: "chat-history"
      name: "Chat History MCP Server"
      jarPath: "../lesson-12-reminder-mcp/chat-history-mcp-server/build/libs/chat-history-mcp-server-1.0.0.jar"
      configPath: "../lesson-12-reminder-mcp/config/chat-history-mcp-server.yaml"
      tools:
        - get_chat_history
    
    - id: "telegram-sender"
      name: "Telegram Sender MCP Server"
      jarPath: "mcp-servers/telegram-sender-mcp-server-1.0.0.jar"
      configPath: "config/telegram-sender-mcp-server.yaml"
      tools:
        - send_telegram_message
```

### 4. –ó–∞–ø—É—Å–∫

```bash
cd server
./gradlew run
```

–ò–ª–∏ —á–µ—Ä–µ–∑ JAR:

```bash
cd server
java -jar build/libs/server-1.0.0.jar
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080

## üéØ API Endpoints

- `GET /` - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- `GET /api/health` - health check
- `GET /api/tools` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `GET /api/connections` - —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ MCP —Å–µ—Ä–≤–µ—Ä–∞–º
- `POST /api/chat/message` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç —Å LLM –∞–≥–µ–Ω—Ç–æ–º

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

1. **get_chat_history** (–∏–∑ lesson-12)
   - –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `startTime`, `endTime`

2. **send_telegram_message** (–Ω–æ–≤—ã–π)
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ Telegram
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `userId`, `message`

## üìä –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã

LLMCompositionAgent —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ü–∏–∫–ª–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- –ú–∞–∫—Å–∏–º—É–º 10 –∏—Ç–µ—Ä–∞—Ü–∏–π (–∑–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞)
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
- LLM —Å–∞–º–∞ —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ –∫–æ–≥–¥–∞ –¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –∫–æ—Ä—É—Ç–∏–Ω—ã
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –≤ UI
- –¢–∞–π–º–∞—É—Ç 120 —Å–µ–∫—É–Ω–¥ –¥–ª—è LLM –∑–∞–ø—Ä–æ—Å–æ–≤

### UI

- –ß–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ MCP —Å–µ—Ä–≤–µ—Ä–∞–º

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–±—Ä–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- ‚úì Telegram Sender MCP Server JAR —Å–æ–±—Ä–∞–Ω –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `mcp-servers/`
- ‚úì –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä JAR —Å–æ–±—Ä–∞–Ω
- ‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram MCP Server –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úì UI —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [THEORY.md](./THEORY.md) - —Ç–µ–æ—Ä–∏—è –ø–æ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- [PROMPT.md](./PROMPT.md) - –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

1. ‚úÖ MCP —Å–µ—Ä–≤–µ—Ä —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
2. ‚úÖ MCP –∫–ª–∏–µ–Ω—Ç –∏ –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
3. ‚úÖ LLM –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º —Ä–µ—à–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
4. ‚úÖ –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã: LLM ‚Üí –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 1 ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí LLM ‚Üí –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç 2 ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí LLM ‚Üí —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
5. ‚úÖ UI —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–í–∞–∂–Ω–æ:** 
- LLM –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –≤—ã–∑–æ–≤–æ–≤
- –ú—ã –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞ –¥–∞—ë–º LLM –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
- –†–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ —Å JAR —Ñ–∞–π–ª–∞–º–∏ MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
