# ะัะธะผะตะฝะธะผะพััั ะฐััะธัะตะบัััะฝะพะณะพ ัะฐะฑะปะพะฝะฐ ะดะปั RAG (Retrieval-Augmented Generation)

## ๐ ะัะฐัะบะธะน ะพัะฒะตั

**โ ะะ, ัะฐะฑะปะพะฝ ะฟะพะปะฝะพัััั ะฟะพะดัะพะดะธั ะดะปั RAG ััะพะบะพะฒ!**

ะััะธัะตะบัััะฐ Clean Architecture ั ัะฐะทะดะตะปะตะฝะธะตะผ ะฝะฐ ัะปะพะธ ัะฝะธะฒะตััะฐะปัะฝะฐ ะธ ะพัะปะธัะฝะพ ะฟะพะดัะพะดะธั ะดะปั RAG. ะัะต ะฝะฐัะฐะฑะพัะบะธ ะธะท 14-ะณะพ ััะพะบะฐ ะผะพะถะฝะพ ะธ ะฝัะถะฝะพ ะฟัะธะผะตะฝััั.

---

## ๐ฏ ะงัะพ ัะฐะบะพะต RAG ะธ ะบะฐะบะธะต ะบะพะผะฟะพะฝะตะฝัั ะฝัะถะฝั

**RAG (Retrieval-Augmented Generation)** โ ััะพ ะฟะพะดัะพะด, ะฟัะธ ะบะพัะพัะพะผ:
1. **ะะพะบัะผะตะฝัั ะธะฝะดะตะบัะธัััััั** ะฒ ะฒะตะบัะพัะฝะพะต ััะฐะฝะธะปะธัะต (vector database)
2. **ะะฐะฟัะพั ะฟะพะปัะทะพะฒะฐัะตะปั** ะฟัะตะพะฑัะฐะทัะตััั ะฒ ัะผะฑะตะดะดะธะฝะณ (embedding)
3. **ะัะฟะพะปะฝัะตััั ะฟะพะธัะบ** ะฟะพ ัะตะปะตะฒะฐะฝัะฝะพััะธ (semantic search) ะฒ ะฒะตะบัะพัะฝะพะน ะะ
4. **ะะฐะนะดะตะฝะฝัะต ะดะพะบัะผะตะฝัั** ะฟะตัะตะดะฐัััั ะฒ LLM ะบะฐะบ ะบะพะฝัะตะบัั
5. **LLM ะณะตะฝะตัะธััะตั ะพัะฒะตั** ะฝะฐ ะพัะฝะพะฒะต ะฝะฐะนะดะตะฝะฝะพะณะพ ะบะพะฝัะตะบััะฐ

### ะะพะผะฟะพะฝะตะฝัั RAG ัะธััะตะผั:

- **ะะตะบัะพัะฝะฐั ะะ**: Chroma, Qdrant, Pinecone, Weaviate, ะธะปะธ ะปะพะบะฐะปัะฝะฐั (ะฝะฐะฟัะธะผะตั, SQLite ั ัะฐััะธัะตะฝะธะตะผ ะดะปั ะฒะตะบัะพัะพะฒ)
- **ะญะผะฑะตะดะดะธะฝะณะธ**: OpenAI Embeddings API, ะปะพะบะฐะปัะฝัะต ะผะพะดะตะปะธ (sentence-transformers)
- **ะะฝะดะตะบัะฐัะธั ะดะพะบัะผะตะฝัะพะฒ**: ัะฐะทะฑะธะตะฝะธะต ะฝะฐ ัะฐะฝะบะธ, ัะพะทะดะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ, ัะพััะฐะฝะตะฝะธะต ะฒ ะฒะตะบัะพัะฝัั ะะ
- **ะะพะธัะบ**: semantic search ะฟะพ ัะตะปะตะฒะฐะฝัะฝะพััะธ
- **ะะตะฝะตัะฐัะธั**: LLM ั ะบะพะฝัะตะบััะพะผ ะธะท ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ

---

## โ ะัะธะผะตะฝะธะผะพััั ะฐััะธัะตะบัััั

### 1. Clean Architecture โ ัะฝะธะฒะตััะฐะปัะฝะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Presentation Layer                                      โ
โ  - ChatController / WebSocketChatController              โ
โ  - DTO ะดะปั ะทะฐะฟัะพัะพะฒ/ะพัะฒะตัะพะฒ                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Domain Layer (RAG Agent)                               โ
โ  - RAGAgent: ะพัะบะตัััะฐัะธั ะฟะพะธัะบะฐ + ะณะตะฝะตัะฐัะธะธ             โ
โ  - ะะพะณะธะบะฐ ัะฐะฑะพัั ั ะบะพะฝัะตะบััะพะผ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Data Layer                                             โ
โ  - VectorDBClient: ัะฐะฑะพัะฐ ั ะฒะตะบัะพัะฝะพะน ะะ                โ
โ  - EmbeddingClient: ัะพะทะดะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ                โ
โ  - AIRepository: ะณะตะฝะตัะฐัะธั ะพัะฒะตัะพะฒ                      โ
โ  - DocumentRepository: ัะฐะฑะพัะฐ ั ะดะพะบัะผะตะฝัะฐะผะธ             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**โ ะะพะปะฝะพัััั ะฟัะธะผะตะฝะธะผะพ!** ะกัััะบัััะฐ ัะปะพะตะฒ ะพััะฐะตััั ัะพะน ะถะต, ะผะตะฝัะตััั ัะพะปัะบะพ ัะพะดะตัะถะธะผะพะต.

---

## ๐ ะะฐัะฐะฑะพัะบะธ ะธะท 14-ะณะพ ััะพะบะฐ ะดะปั RAG

### 1. โ WebSocket ะดะปั real-time ะพะฑะฝะพะฒะปะตะฝะธะน

**ะัะธะผะตะฝะตะฝะธะต ะฒ RAG:**
- ะะพะบะฐะทัะฒะฐัั ััะฐััั ะธะฝะดะตะบัะฐัะธะธ ะดะพะบัะผะตะฝัะพะฒ: "ะะฝะดะตะบัะธััั ะดะพะบัะผะตะฝั 1 ะธะท 10..."
- ะะพะบะฐะทัะฒะฐัั ะฟัะพัะตัั ะฟะพะธัะบะฐ: "ะัั ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั..."
- ะะพะบะฐะทัะฒะฐัั ะฟัะพัะตัั ะณะตะฝะตัะฐัะธะธ: "ะะตะฝะตัะธััั ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ..."

**ะะพะด ะธะท 14-ะณะพ ััะพะบะฐ:**
```kotlin
// WebSocketChatController.kt - ะฟะพะปะฝะพัััั ะฟัะธะผะตะฝะธะผะพ
val statusCallback: (String) -> Unit = { statusMessage ->
    val statusUpdate = StatusUpdate(message = statusMessage)
    messageChannel.trySend(json.encodeToString(statusUpdate))
}
```

**ะะดะฐะฟัะฐัะธั ะดะปั RAG:**
```kotlin
// ะ RAGAgent
statusCallback?.invoke("ะัั ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั...")
val results = vectorDBClient.search(queryEmbedding, topK = 5)
statusCallback?.invoke("ะะฐะนะดะตะฝะพ ${results.size} ะดะพะบัะผะตะฝัะพะฒ. ะะตะฝะตัะธััั ะพัะฒะตั...")
```

---

### 2. โ OrchestrationAgent โ ะฟะฐััะตัะฝ ะพัะบะตัััะฐัะธะธ

**ะัะธะผะตะฝะตะฝะธะต ะฒ RAG:**
- ะัะบะตัััะฐัะธั ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ: ะฟะพะธัะบ โ ัะธะปัััะฐัะธั โ ะณะตะฝะตัะฐัะธั
- ะฃะฟัะฐะฒะปะตะฝะธะต ะฝะตัะบะพะปัะบะธะผะธ ะธััะพัะฝะธะบะฐะผะธ ะดะฐะฝะฝัั (ะตัะปะธ ะธัะฟะพะปัะทัะตััั ะณะธะฑัะธะดะฝัะน ะฟะพะธัะบ)
- ะะพะพัะดะธะฝะฐัะธั ะผะตะถะดั ะฒะตะบัะพัะฝะพะน ะะ ะธ LLM

**ะะพะด ะธะท 14-ะณะพ ััะพะบะฐ:**
```kotlin
// OrchestrationAgent.kt - ะฟะฐััะตัะฝ ะฟัะธะผะตะฝะธะผ
suspend fun processUserMessage(
    userMessage: String,
    statusCallback: ((String) -> Unit)? = null,
    toolCallCallback: ((String, String, String?) -> Unit)? = null
): AgentResponse {
    // 1. ะะพะธัะบ ะดะพะบัะผะตะฝัะพะฒ
    // 2. ะคะพัะผะธัะพะฒะฐะฝะธะต ะบะพะฝัะตะบััะฐ
    // 3. ะะตะฝะตัะฐัะธั ะพัะฒะตัะฐ
}
```

**ะะดะฐะฟัะฐัะธั ะดะปั RAG:**
```kotlin
class RAGAgent(
    private val aiRepository: AIRepository,
    private val vectorDBClient: VectorDBClient,
    private val embeddingClient: EmbeddingClient
) {
    suspend fun processUserMessage(
        userMessage: String,
        statusCallback: ((String) -> Unit)? = null
    ): AgentResponse {
        // 1. ะกะพะทะดะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะฐ ะทะฐะฟัะพัะฐ
        statusCallback?.invoke("ะะฝะฐะปะธะทะธััั ะทะฐะฟัะพั...")
        val queryEmbedding = embeddingClient.createEmbedding(userMessage)
        
        // 2. ะะพะธัะบ ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ
        statusCallback?.invoke("ะัั ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั...")
        val results = vectorDBClient.search(queryEmbedding, topK = 5)
        
        // 3. ะคะพัะผะธัะพะฒะฐะฝะธะต ะบะพะฝัะตะบััะฐ
        statusCallback?.invoke("ะคะพัะผะธััั ะบะพะฝัะตะบัั ะธะท ${results.size} ะดะพะบัะผะตะฝัะพะฒ...")
        val context = formatContext(results)
        
        // 4. ะะตะฝะตัะฐัะธั ะพัะฒะตัะฐ
        statusCallback?.invoke("ะะตะฝะตัะธััั ะพัะฒะตั ะฝะฐ ะพัะฝะพะฒะต ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ...")
        val response = aiRepository.getMessageWithContext(userMessage, context)
        
        return AgentResponse.Success(response)
    }
}
```

---

### 3. โ MCP ัะตัะฒะตัั ะดะปั ะฒะตะบัะพัะฝะพะน ะะ

**ะัะธะผะตะฝะตะฝะธะต ะฒ RAG:**
- MCP ัะตัะฒะตั ะดะปั ัะฐะฑะพัั ั ะฒะตะบัะพัะฝะพะน ะะ (ะธะฝะดะตะบัะฐัะธั, ะฟะพะธัะบ)
- MCP ัะตัะฒะตั ะดะปั ัะฐะฑะพัั ั ัะผะฑะตะดะดะธะฝะณะฐะผะธ
- MCP ัะตัะฒะตั ะดะปั ัะฐะฑะพัั ั ะดะพะบัะผะตะฝัะฐะผะธ (ะฟะฐััะธะฝะณ, ัะฐะฝะบะธะฝะณ)

**ะะพะด ะธะท 14-ะณะพ ััะพะบะฐ:**
```kotlin
// MCPToolAgent.kt - ะฟะพะปะฝะพัััั ะฟัะธะผะตะฝะธะผะพ
suspend fun getLLMTools(): List<ToolDto> {
    val mcpTools = mcpClientManager.listAllTools()
    return mcpTools.map { /* ... */ }
}
```

**ะะดะฐะฟัะฐัะธั ะดะปั RAG:**
```yaml
# config/mcp-servers.yaml
mcp:
  servers:
    - id: "vector-db"
      name: "Vector Database MCP Server"
      description: "ะะฐะฑะพัะฐ ั ะฒะตะบัะพัะฝะพะน ะฑะฐะทะพะน ะดะฐะฝะฝัั"
      jarPath: "mcp-servers/vector-db-mcp-server-1.0.0.jar"
      tools:
        - search_documents
        - index_document
        - get_document_by_id
    
    - id: "embeddings"
      name: "Embeddings MCP Server"
      description: "ะกะพะทะดะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ"
      jarPath: "mcp-servers/embeddings-mcp-server-1.0.0.jar"
      tools:
        - create_embedding
        - create_embeddings_batch
```

**ะัะธะผะตั MCP ะธะฝััััะผะตะฝัะฐ ะดะปั ะฟะพะธัะบะฐ:**
```kotlin
// ะ vector-db-mcp-server
server.addTool(
    name = "search_documents",
    description = "ะะพะธัะบ ัะตะปะตะฒะฐะฝัะฝัั ะดะพะบัะผะตะฝัะพะฒ ะฟะพ ะทะฐะฟัะพัั",
    inputSchema = Tool.Input(
        properties = buildJsonObject {
            putJsonObject("query_embedding") {
                put("type", "array")
                put("items", buildJsonObject { put("type", "number") })
                put("description", "ะญะผะฑะตะดะดะธะฝะณ ะทะฐะฟัะพัะฐ (ะผะฐััะธะฒ ัะธัะตะป)")
            }
            putJsonObject("top_k") {
                put("type", "integer")
                put("description", "ะะพะปะธัะตััะฒะพ ะดะพะบัะผะตะฝัะพะฒ ะดะปั ะฒะพะทะฒัะฐัะฐ")
            }
        },
        required = listOf("query_embedding", "top_k")
    )
) { request ->
    val params = SearchDocumentsParams.from(request.arguments)
    val results = vectorDBRepository.search(params.queryEmbedding, params.topK)
    handler.handle(results)
}
```

---

### 4. โ ะกะธััะตะผะฝัะน ะฟัะพะผะฟั ั ะฟัะฐะฒะธะปะฐะผะธ ะดะปั content

**ะัะธะผะตะฝะตะฝะธะต ะฒ RAG:**
- ะัะฐะฒะธะปะฐ ะดะปั ัะฐะฑะพัั ั ะบะพะฝัะตะบััะพะผ ะธะท ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ
- ะะฝััััะบัะธะธ ะฟะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ัะตะปะตะฒะฐะฝัะฝะพะน ะธะฝัะพัะผะฐัะธะธ
- ะัะฐะฒะธะปะฐ ัะธัะธัะพะฒะฐะฝะธั ะธััะพัะฝะธะบะพะฒ

**ะะพะด ะธะท 14-ะณะพ ััะพะบะฐ:**
```kotlin
// OrchestrationAgent.kt - buildSystemPrompt()
// ะัะธัะธัะตัะบะธ ะฒะฐะถะฝะพ: ะทะฐะฟะพะปะฝะตะฝะธะต content ะฟัะธ ะฒัะทะพะฒะต ะธะฝััััะผะตะฝัะพะฒ
```

**ะะดะฐะฟัะฐัะธั ะดะปั RAG:**
```kotlin
private fun buildSystemPrompt(context: String): String {
    return """
        ะขั โ ะธะฝัะตะปะปะตะบััะฐะปัะฝัะน ะฐััะธััะตะฝั ั ะดะพัััะฟะพะผ ะบ ะฑะฐะทะต ะทะฝะฐะฝะธะน.
        
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        ๐จ ะะะะขะะงะะกะะ ะะะะะ - ะะะะะขะ ะก ะะะะขะะะกะขะะ ๐จ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        
        ะขั ะฟะพะปััะธะป ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั ะธะท ะฑะฐะทั ะทะฝะฐะฝะธะน. ะะะะะ:
        
        1. ะัะฟะพะปัะทัะน ะขะะะฌะะ ะธะฝัะพัะผะฐัะธั ะธะท ะฟัะตะดะพััะฐะฒะปะตะฝะฝะพะณะพ ะบะพะฝัะตะบััะฐ
        2. ะัะปะธ ะธะฝัะพัะผะฐัะธะธ ะฝะตั ะฒ ะบะพะฝัะตะบััะต โ ัะตััะฝะพ ัะบะฐะถะธ ะพะฑ ััะพะผ
        3. ะฆะธัะธััะน ะธััะพัะฝะธะบะธ, ะบะพะณะดะฐ ััะพ ะฒะพะทะผะพะถะฝะพ
        4. ะะต ะฒัะดัะผัะฒะฐะน ัะฐะบัั, ะบะพัะพััั ะฝะตั ะฒ ะบะพะฝัะตะบััะต
        
        ะะะะขะะะกะข ะะ ะะะะซ ะะะะะะ:
        $context
        
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        ๐จ ะกะะะะ ะะะะขะะงะะกะะะ ะะะะะะะ - ะงะะขะะ ะะะะะซะ ะ ะะะะะะะ ะะะะกะะะะ! ๐จ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        
        ะะะ ะะะะะะ ะะซะะะะ ะะะกะขะะฃะะะะขะ ะะะะ "content" ะะะฏะะะขะะะฌะะ ะะะะะะ ะะซะขะฌ ะะะะะะะะะ!
        
        [ะััะฐะปัะฝัะต ะฟัะฐะฒะธะปะฐ ะธะท ัะฐะฑะปะพะฝะฐ...]
    """.trimIndent()
}
```

---

### 5. โ Callbacks ะดะปั ััะฐัััะพะฒ ะธะฝััััะผะตะฝัะพะฒ

**ะัะธะผะตะฝะตะฝะธะต ะฒ RAG:**
- ะกัะฐััั ะธะฝะดะตะบัะฐัะธะธ: "ะะฝะดะตะบัะธััั ะดะพะบัะผะตะฝั..."
- ะกัะฐััั ะฟะพะธัะบะฐ: "ะัั ัะตะปะตะฒะฐะฝัะฝัะต ะดะพะบัะผะตะฝัั..."
- ะกัะฐััั ะณะตะฝะตัะฐัะธะธ: "ะะตะฝะตัะธััั ะพัะฒะตั..."

**ะะพะด ะธะท 14-ะณะพ ััะพะบะฐ:**
```kotlin
// OrchestrationAgent.kt
toolCallCallback?.invoke(toolName, "starting", null)
// ... ะฒัะฟะพะปะฝะตะฝะธะต ะธะฝััััะผะตะฝัะฐ ...
toolCallCallback?.invoke(toolName, "success", "ะะฝััััะผะตะฝั ะฒัะฟะพะปะฝะตะฝ ััะฟะตัะฝะพ")
```

**ะะดะฐะฟัะฐัะธั ะดะปั RAG:**
```kotlin
// ะ RAGAgent ะฟัะธ ะธะฝะดะตะบัะฐัะธะธ ะดะพะบัะผะตะฝัะพะฒ
toolCallCallback?.invoke("index_document", "starting", null)
try {
    vectorDBClient.indexDocument(document)
    toolCallCallback?.invoke("index_document", "success", "ะะพะบัะผะตะฝั ะฟัะพะธะฝะดะตะบัะธัะพะฒะฐะฝ")
} catch (e: Exception) {
    toolCallCallback?.invoke("index_document", "error", "ะัะธะฑะบะฐ: ${e.message}")
}
```

---

## ๐ ะกัััะบัััะฐ ััะพะบะฐ ั RAG

```
lesson-15-rag/
โโโ server/
โ   โโโ src/main/kotlin/com/prike/
โ       โโโ domain/
โ       โ   โโโ agent/
โ       โ       โโโ BaseAgent.kt              # โ ะะท ัะฐะฑะปะพะฝะฐ
โ       โ       โโโ RAGAgent.kt               # ๐ ะะพะฒัะน ะฐะณะตะฝั ะดะปั RAG
โ       โ
โ       โโโ data/
โ       โ   โโโ client/
โ       โ   โ   โโโ OpenAIClient.kt           # โ ะะท ัะฐะฑะปะพะฝะฐ
โ       โ   โ   โโโ EmbeddingClient.kt        # ๐ ะะปะธะตะฝั ะดะปั ัะผะฑะตะดะดะธะฝะณะพะฒ
โ       โ   โ   โโโ VectorDBClient.kt         # ๐ ะะปะธะตะฝั ะดะปั ะฒะตะบัะพัะฝะพะน ะะ
โ       โ   โ   โโโ MCPClient.kt               # โ ะะท 14-ะณะพ ััะพะบะฐ
โ       โ   โโโ repository/
โ       โ   โ   โโโ AIRepository.kt           # โ ะะท ัะฐะฑะปะพะฝะฐ
โ       โ   โ   โโโ DocumentRepository.kt      # ๐ ะะตะฟะพะทะธัะพัะธะน ะดะปั ะดะพะบัะผะตะฝัะพะฒ
โ       โ   โโโ dto/
โ       โ       โโโ [DTO ะดะปั ะฒะตะบัะพัะฝะพะน ะะ]     # ๐ DTO ะดะปั ัะฐะฑะพัั ั ะฒะตะบัะพัะฐะผะธ
โ       โ
โ       โโโ presentation/
โ           โโโ controller/
โ           โ   โโโ ChatController.kt         # โ ะะท ัะฐะฑะปะพะฝะฐ
โ           โ   โโโ WebSocketChatController.kt # โ ะะท 14-ะณะพ ััะพะบะฐ
โ           โโโ dto/
โ               โโโ [Client DTOs]              # โ ะะท ัะฐะฑะปะพะฝะฐ
โ
โโโ vector-db-mcp-server/                      # ๐ MCP ัะตัะฒะตั ะดะปั ะฒะตะบัะพัะฝะพะน ะะ
โ   โโโ [ััััะบัััะฐ MCP ัะตัะฒะตัะฐ ะธะท MCP_GUIDE.md]
โ
โโโ config/
โ   โโโ ai.yaml                                # โ ะะท ัะฐะฑะปะพะฝะฐ
โ   โโโ mcp-servers.yaml                       # โ ะะท 14-ะณะพ ััะพะบะฐ
โ
โโโ data/
    โโโ vector-db/                             # ๐ ะะตะบัะพัะฝะฐั ะะ (ะฝะฐะฟัะธะผะตั, Chroma)
```

---

## ๐ง ะงัะพ ะฝัะถะฝะพ ะดะพะฑะฐะฒะธัั ะดะปั RAG

### 1. ะะตะบัะพัะฝะฐั ะะ ะบะปะธะตะฝั

```kotlin
// data/client/VectorDBClient.kt
interface VectorDBClient {
    suspend fun search(
        queryEmbedding: List<Float>,
        topK: Int = 5,
        collection: String = "documents"
    ): List<SearchResult>
    
    suspend fun indexDocument(
        document: Document,
        embedding: List<Float>,
        collection: String = "documents"
    ): String // ะฒะพะทะฒัะฐัะฐะตั document ID
    
    suspend fun getDocumentById(id: String): Document?
}
```

### 2. Embedding ะบะปะธะตะฝั

```kotlin
// data/client/EmbeddingClient.kt
interface EmbeddingClient {
    suspend fun createEmbedding(text: String): List<Float>
    suspend fun createEmbeddings(texts: List<String>): List<List<Float>>
}
```

### 3. RAG Agent

```kotlin
// domain/agent/RAGAgent.kt
class RAGAgent(
    private val aiRepository: AIRepository,
    private val vectorDBClient: VectorDBClient,
    private val embeddingClient: EmbeddingClient
) {
    suspend fun processUserMessage(
        userMessage: String,
        statusCallback: ((String) -> Unit)? = null
    ): AgentResponse {
        // ะะตะฐะปะธะทะฐัะธั RAG ะปะพะณะธะบะธ
    }
}
```

---

## โ ะงะตะบะปะธัั ะดะปั RAG ััะพะบะฐ

- [ ] ะกะบะพะฟะธัะพะฒะฐะฝ ัะฐะฑะปะพะฝ ะธะท `lesson-00-project-template`
- [ ] ะะพะฑะฐะฒะปะตะฝ `VectorDBClient` ะฒ `data/client/`
- [ ] ะะพะฑะฐะฒะปะตะฝ `EmbeddingClient` ะฒ `data/client/`
- [ ] ะกะพะทะดะฐะฝ `RAGAgent` ะฒ `domain/agent/` (ะฝะฐัะปะตะดัะตั `BaseAgent`)
- [ ] ะัะฟะพะปัะทะพะฒะฐะฝ `WebSocketChatController` ะธะท 14-ะณะพ ััะพะบะฐ
- [ ] ะะพะฑะฐะฒะปะตะฝั callbacks ะดะปั ััะฐัััะพะฒ (ะธะท 14-ะณะพ ััะพะบะฐ)
- [ ] ะกะพะทะดะฐะฝ MCP ัะตัะฒะตั ะดะปั ะฒะตะบัะพัะฝะพะน ะะ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- [ ] ะะฐัััะพะตะฝ ัะธััะตะผะฝัะน ะฟัะพะผะฟั ั ะฟัะฐะฒะธะปะฐะผะธ ะดะปั content (ะธะท ัะฐะฑะปะพะฝะฐ)
- [ ] ะะพะฑะฐะฒะปะตะฝะฐ ะพะฑัะฐะฑะพัะบะฐ ะบะพะฝัะตะบััะฐ ะธะท ะฝะฐะนะดะตะฝะฝัั ะดะพะบัะผะตะฝัะพะฒ
- [ ] ะะฐัััะพะตะฝะพ ะปะพะณะธัะพะฒะฐะฝะธะต (INFO, WARN, ERROR)
- [ ] ะกะพะทะดะฐะฝ `README.md` ั ะพะฟะธัะฐะฝะธะตะผ ะทะฐะดะฐะฝะธั

---

## ๐ฏ ะะตะบะพะผะตะฝะดะฐัะธะธ

### โ ะัะธะผะตะฝััั ะธะท 14-ะณะพ ััะพะบะฐ:

1. **WebSocket ะดะปั real-time ะพะฑะฝะพะฒะปะตะฝะธะน** โ ะบัะธัะธัะตัะบะธ ะฒะฐะถะฝะพ ะดะปั UX
2. **Callbacks ะดะปั ััะฐัััะพะฒ** โ ะฟะพะบะฐะทัะฒะฐัั ะฟัะพัะตัั ะฟะพะธัะบะฐ ะธ ะณะตะฝะตัะฐัะธะธ
3. **OrchestrationAgent ะฟะฐััะตัะฝ** โ ะดะปั ะบะพะพัะดะธะฝะฐัะธะธ ะฟะพะธัะบะฐ ะธ ะณะตะฝะตัะฐัะธะธ
4. **MCP ัะตัะฒะตัั** โ ะดะปั ะธะทะพะปััะธะธ ัะฐะฑะพัั ั ะฒะตะบัะพัะฝะพะน ะะ
5. **ะกะธััะตะผะฝัะน ะฟัะพะผะฟั ั ะฟัะฐะฒะธะปะฐะผะธ** โ ะดะปั ัะฐะฑะพัั ั ะบะพะฝัะตะบััะพะผ ะธ content

### ๐ ะะพะฑะฐะฒะธัั ะดะปั RAG:

1. **VectorDBClient** โ ะบะปะธะตะฝั ะดะปั ะฒะตะบัะพัะฝะพะน ะะ
2. **EmbeddingClient** โ ะบะปะธะตะฝั ะดะปั ัะพะทะดะฐะฝะธั ัะผะฑะตะดะดะธะฝะณะพะฒ
3. **RAGAgent** โ ัะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัะน ะฐะณะตะฝั ะดะปั RAG
4. **DocumentRepository** โ ัะตะฟะพะทะธัะพัะธะน ะดะปั ัะฐะฑะพัั ั ะดะพะบัะผะตะฝัะฐะผะธ
5. **ะงะฐะฝะบะธะฝะณ ะดะพะบัะผะตะฝัะพะฒ** โ ัะฐะทะฑะธะตะฝะธะต ะฝะฐ ัะฐััะธ ะดะปั ะธะฝะดะตะบัะฐัะธะธ

---

## ๐ ะกะผ. ัะฐะบะถะต

- **[ARCHITECTURE_GUIDE.md](./ARCHITECTURE_GUIDE.md)** โ ะฟะพะปะฝัะน ะฐััะธัะตะบัััะฝัะน ะณะฐะนะด
- **[MCP_GUIDE.md](./MCP_GUIDE.md)** โ ััะบะพะฒะพะดััะฒะพ ะฟะพ ัะพะทะดะฐะฝะธั MCP ัะตัะฒะตัะพะฒ
- **[lesson-14-orchestration/](./lesson-14-orchestration/)** โ ะฟัะธะผะตั ะพัะบะตัััะฐัะธะธ ั WebSocket

---

**ะัะฒะพะด:** ะััะธัะตะบัััะฝัะน ัะฐะฑะปะพะฝ ะธ ะฒัะต ะฝะฐัะฐะฑะพัะบะธ ะธะท 14-ะณะพ ััะพะบะฐ ะฟะพะปะฝะพัััั ะฟัะธะผะตะฝะธะผั ะดะปั RAG. ะัะถะฝะพ ัะพะปัะบะพ ะดะพะฑะฐะฒะธัั ัะฟะตัะธัะธัะฝัะต ะดะปั RAG ะบะพะผะฟะพะฝะตะฝัั (ะฒะตะบัะพัะฝะฐั ะะ, ัะผะฑะตะดะดะธะฝะณะธ), ะฝะพ ััััะบัััะฐ ะธ ะฟะฐััะตัะฝั ะพััะฐัััั ัะตะผะธ ะถะต.


